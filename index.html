import React, { useState, useEffect } from 'react';
import { initializeApp } from 'firebase/app';
import { 
  getAuth, 
  signInAnonymously, 
  signInWithCustomToken,
  onAuthStateChanged 
} from 'firebase/auth';
import { 
  getFirestore, 
  collection, 
  addDoc, 
  onSnapshot, 
  doc, 
  updateDoc, 
  deleteDoc, 
  setDoc,
  serverTimestamp
} from 'firebase/firestore';
import { 
  Users, 
  MapPin, 
  Calendar, 
  CheckCircle, 
  Clock, 
  MessageCircle, 
  Shield, 
  LogOut,
  Send,
  XCircle,
  Banknote,
  Copy,
  ExternalLink,
  ClipboardCheck,
  AlertCircle,
  AlertTriangle,
  Info,
  Edit3,
  Save,
  Settings,
  User,
  Activity,
  Smile,
  Coffee,
  Award,
  Globe,
  ImageIcon,
  HelpCircle,
  Share2,
  MessageSquare,
  Hourglass,
  ThumbsUp,
  List,
  RefreshCw,
  Upload,
  BookOpen,
  ArrowRightLeft,
  Lightbulb,
  ChevronDown,
  ChevronUp,
  Phone
} from 'lucide-react';

// --- Firebase Configuration ---
const firebaseConfig = JSON.parse(__firebase_config);
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

// Collection References
const ATTENDEES_COLLECTION = 'english_meetup_attendees';
const CONFIG_COLLECTION = 'english_meetup_config'; 
const CONFIG_DOC_ID = 'meetup_info'; 

export default function EnglishMeetupRSVP() {
  const [user, setUser] = useState(null);
  const [attendees, setAttendees] = useState([]);
  
  // --- Dynamic Meetup Info State ---
  const [meetupInfo, setMeetupInfo] = useState({
    // 1. Header Info
    clubName: "Jett's English Crew",
    meetupTitle: "ÏÑ±Î∂Å Ï§ëÏÉÅÍ∏â ÏòÅÏñ¥ÌöåÌôî & ÌÜ†Î°†", // Updated
    meetupDesc: "ÏùºÏÉÅ ÌöåÌôîÎ•º ÏûêÏú†Î°≠Í≤å Íµ¨ÏÇ¨ÌïòÎäî Í≤ÉÏùÑ ÎÑòÏñ¥, Îçî ÍπäÏù¥ ÏûàÎäî ÏòÅÏñ¥ ÌÜ†Î°†ÏùÑ Ïó∞ÏäµÌïòÎäî Ï§ëÏÉÅÍ∏â Î™®ÏûÑÏûÖÎãàÎã§.", // Updated
    
    // 2. Basic Info
    date: "2026ÎÖÑ 1Ïõî 25Ïùº (Ïùº)",
    time: "Ïò§Ï†Ñ 10:00 - 12:00",
    locationName: "Ïä§ÌÉÄÎ≤ÖÏä§ ÏÑ±Ïã†Ïó¨ÎåÄÏûÖÍµ¨Ïó≠Ï†ê",
    locationAddress: "ÏÑúÏö∏ ÏÑ±Î∂ÅÍµ¨ ÎèôÏÜåÎ¨∏Î°ú20Í∏∏ 4",
    locationLink: "https://map.naver.com/v5/search/Ïä§ÌÉÄÎ≤ÖÏä§%20ÏÑ±Ïã†Ïó¨ÎåÄÏûÖÍµ¨Ïó≠Ï†ê",

    // --- Curriculum Part 1 ---
    part1Title: "Part 1. Foundation & First Strike",
    part1Duration: "50 min",
    p1Time1: "10'", p1Title1: "Ice-breaking & Warm-up", p1Desc1: "Í∞ÄÎ≤ºÏö¥ ÏßàÎ¨∏Í≥º Ïä§Î™∞ÌÜ°ÏúºÎ°ú Î∂ÄÎìúÎü¨Ïö¥ Î∂ÑÏúÑÍ∏∞ Ï°∞ÏÑ±",
    p1Time2: "15'", p1Title2: "Article Reading & Sentence Building", p1Desc2: "ÎãπÏùº ÌÜ†Î°† Ï£ºÏ†ú Í¥ÄÎ†® Í∏∞ÏÇ¨ Î¶¨Îî© Î∞è ÌïµÏã¨ ÌëúÌòÑ ÏäµÎìù\nKey Usage: Ï£ºÏöî ÌëúÌòÑÏùÑ ÌôúÏö©Ìïú Î≥∏Ïù∏ÎßåÏùò ÏòàÎ¨∏ ÏûëÏÑ± Î∞è Í≥µÏú†",
    p1Time3: "25'", p1Title3: "1st Debate Session (2:2)", p1Desc3: "ÌÖåÏù¥Î∏îÎ≥Ñ Ï∞¨ÏÑ±(Pro)/Î∞òÎåÄ(Con) Ìè¨ÏßÄÏÖò Í≤∞Ï†ï Î∞è Ï≤´ Î≤àÏß∏ Ïã§Ï†Ñ ÌÜ†Î°†",

    // --- Intermission ---
    breakTitle: "Intermission (10 min)",
    breakDesc: "The Big Swap: Ï∞¨ÏÑ±(Pro) ÌåÄÏùÄ ÏòÜ ÌÖåÏù¥Î∏îÎ°ú Ïù¥ÎèôÌïòÏó¨ ÏÉàÎ°úÏö¥ ÌååÌä∏ÎÑàÏôÄ Îß§Ïπ≠Îê©ÎãàÎã§.",

    // --- Curriculum Part 2 ---
    part2Title: "Part 2. Deep Dive & Fine-tuning",
    part2Duration: "50 min",
    p2Time1: "25'", p2Title1: "2nd Debate Session (2:2)", p2Desc1: "ÌååÌä∏ÎÑà ÍµêÏ≤¥ ÌõÑ Ïã¨Ìôî ÌÜ†Î°† (1Î∂ÄÏùò ÎÖºÎ¶¨Î•º Î≥¥ÏôÑÌïòÍ≥† Î∞∞Ïö¥ ÌëúÌòÑ Ïû¨ÌôúÏö©)",
    p2Time2: "15'", p2Title2: "Expression Hunting (KOR-to-ENG)", p2Desc2: "\"Ïù¥ ÌëúÌòÑ, ÏòÅÏñ¥Î°ú Íº≠ ÌïòÍ≥† Ïã∂ÏóàÏñ¥Ïöî\": ÌÜ†Î°† Ï§ë ÎßâÌòîÎçò ÌïúÍµ≠Ïñ¥ Î¨∏Íµ¨Î•º Í≥µÏú†ÌïòÍ≥†, Îã§ Ìï®Íªò Í∞ÄÏû• ÏÑ∏Î†®Îêú ÏòÅÏñ¥ Î¨∏Ïû•ÏúºÎ°ú Ïû¨Íµ¨ÏÑ±",
    p2Time3: "10'", p2Title3: "Wrap-up & Final Small Talk", p2Desc3: "Ïò§Îäò Î∞∞Ïö¥ ÏµúÍ≥†Ïùò Î¨∏Ïû•ÏùÑ Î¶¨ÎßàÏù∏ÎìúÌïòÎ©∞ ÏûêÏú†Î°úÏö¥ ÏÜåÍ∞êÍ≥º Ìï®Íªò ÎßàÎ¨¥Î¶¨",

    // --- Participation Rules ---
    rulesTitle: "Participation Rules",
    rule1: "Facilitator System: Í∞Å ÌÖåÏù¥Î∏î Î¶¨ÎçîÍ∞Ä Î∞úÏñ∏ ÏãúÍ∞ÑÏùÑ Í≥µÏ†ïÌïòÍ≤å Ï°∞Ïú®ÌïòÍ≥† ÌîºÎìúÎ∞±ÏùÑ ÎèïÏäµÎãàÎã§.",
    rule2: "Repetitive Learning: 1Î∂ÄÏóêÏÑú ÎßåÎì† ÏòàÎ¨∏ÏùÑ 2Î∂Ä ÌÜ†Î°†ÏóêÏÑú Ïã§Ï†úÎ°ú Ìïú Î≤à Îçî ÏÇ¨Ïö©Ìï¥ Î≥¥Îäî Í≤ÉÏùÑ Í∞ïÎ†•Ìûà Í∂åÏû•Ìï©ÎãàÎã§.",
    rule3: "Focus on Fluency: ÏÑ∏ÏÖò Ï§ëÏóêÎäî ÏòÅÏñ¥ ÏÇ¨Ïö©ÏùÑ ÏõêÏπôÏúºÎ°ú ÌïòÎ©∞, ÌïúÍµ≠Ïñ¥ ÏßàÎ¨∏ÏùÄ 'Expression Hunting' ÏãúÍ∞ÑÏóê ÏßëÏ§ëÏ†ÅÏúºÎ°ú Ìï¥Í≤∞Ìï©ÎãàÎã§.",

    // Topic
    topicTitle: "Travel & Adventure",
    session2Topic: "Travel Styles",
    session2Question: "Do you prefer planning every detail of a trip or being spontaneous? What are the pros and cons?",

    // Settings
    maxCapacity: 4,
    fee: "2,000",
    originalFee: "5,000", 
    drinkPolicy: "‚òï Í∞úÏù∏ ÏùåÎ£åÎäî Î≥ÑÎèÑÎ°ú Ï£ºÎ¨∏Ìï¥Ï£ºÏÑ∏Ïöî (1Ïù∏ 1Î©îÎâ¥)", 
    bankName: "Ïπ¥Ïπ¥Ïò§Î±ÖÌÅ¨",
    bankAccount: "3333-26-2044919",
    accountHolder: "Ïù¥ÏÉÅÌù¨",

    // Leader Info
    leaderName: "Jett",
    leaderImage: "https://api.dicebear.com/9.x/avataaars/svg?seed=Jett&backgroundColor=c0aede", 
    leaderBio: "Î∞òÍ∞ëÏäµÎãàÎã§! Î¶¨Îçî JettÏûÖÎãàÎã§. üëã\nÏ†Ä ÎòêÌïú Ïó¨Îü¨Î∂ÑÍ≥º Ìï®Íªò ÏÑ±Ïû•Ìï¥Í∞ÄÎäî Ï§ë~Ï§ëÏÉÅÍ∏â ÏòÅÏñ¥ ÌïôÏäµÏûêÏûÖÎãàÎã§. Ìò∏Ï£º ÏõåÌôÄÍ≥º TESOL Í≥ºÏ†ïÏùÑ Í±∞Ï≥§ÏßÄÎßå, Ïó¨Ï†ÑÌûà ÏòÅÏñ¥Î•º Ïì∞Í≥† Î∞∞Ïö∞Îäî Í≥ºÏ†ï ÏûêÏ≤¥Í∞Ä Ï¶êÍ±∞Ïö¥ Ïó∞ÏäµÏÉùÏù¥Ï£†.\n\n'ÏôÑÎ≤ΩÌï®'Î≥¥Îã§Îäî 'ÏÜåÌÜµÏùò Ï¶êÍ±∞ÏõÄ'ÏùÑ Ï§ëÏöîÌïòÍ≤å ÏÉùÍ∞ÅÌï©ÎãàÎã§. 3ÎÖÑÍ∞Ñ Î™®ÏûÑÏùÑ Ïù¥ÎÅåÏñ¥Ïò® Í≤ΩÌóòÏúºÎ°ú Ìé∏ÏïàÌïú Î∂ÑÏúÑÍ∏∞Î•º ÎßåÎì§Ïñ¥ ÎìúÎ¶¥Í≤åÏöî. Î∂ÄÎã¥ ÏóÜÏù¥ Ïò§ÏÖîÏÑú Ìï®Íªò Îñ†Îì§Ïñ¥Ïöî! üåè‚ú®", // Updated
    leaderTags: "TESOL ÏàòÎ£å, Ìò∏Ï£º ÏõåÌÇπÌôÄÎ¶¨Îç∞Ïù¥, ÏÑ∏Í≥ÑÏùºÏ£º, Ïª¨Ïª¥ Î¶¨Îçî 3ÎÖÑ+, ÌïÑÎ¶¨ÌïÄ Ïñ¥ÌïôÏó∞Ïàò, TOEFL/IELTS Í≤ΩÌóò",

    // Etiquette
    etiquetteTitle: "ÌÅ¥ÎüΩ Í∑úÏπô",
    etiquette1Title: "üëÇ ÏÑúÎ°úÎ•º Ï°¥Ï§ëÌïòÍ≥† Í≤ΩÏ≤≠Ìï¥Ïöî",
    etiquette1Desc: "ÌÉÄÏù∏Ïùò Î∞úÏñ∏ Ï§ëÏóêÎäî Ìï∏ÎìúÌè∞ ÏÇ¨Ïö©ÏùÑ ÏûêÏ†úÌïòÍ≥† Í∑Ä Í∏∞Ïö∏Ïó¨Ï£ºÏÑ∏Ïöî. Î¨¥Î°ÄÌïú Ïñ∏ÌñâÏù¥ÎÇò Í≥ºÎèÑÌïú ÏÇ¨ÏÉùÌôú ÏßàÎ¨∏ÏùÄ No!",
    etiquette2Title: "‚è≥ Î∞úÏñ∏Í∂åÏùÄ Í≥µÌèâÌïòÍ≤å",
    etiquette2Desc: "Ìïú ÏÇ¨ÎûåÏù¥ ÎåÄÌôîÎ•º ÎèÖÏ†êÌïòÏßÄ ÏïäÎèÑÎ°ù Î∞∞Î†§Ìï¥Ï£ºÏÑ∏Ïöî. (Ìïú ÌÑ¥Ïóê 2~3Î∂Ñ Ïù¥ÎÇ¥Î°ú ÎßêÌïòÍ∏∞)",
    etiquette3Title: "üö´ ÏàúÏàòÌïú ÌïôÏäµ Î™®ÏûÑÏûÖÎãàÎã§",
    etiquette3Desc: "Ï¢ÖÍµê ÌôúÎèô, ÏòÅÏóÖ, Ïù¥ÏÑ± ÍµêÏ†ú Î™©Ï†ÅÏùò Ï∞∏Ïó¨Îäî ÏóÑÍ≤©Ìûà Í∏àÏßÄÌïòÎ©∞ Í∞ïÌá¥ ÏÇ¨Ïú†Í∞Ä Îê©ÎãàÎã§.",

    // FAQ & Contact
    openChatLink: "https://open.kakao.com/o/sExample", 
    faq1Q: "Ï£ºÏ∞® Í∞ÄÎä•ÌïúÍ∞ÄÏöî?",
    faq1A: "Ïä§ÌÉÄÎ≤ÖÏä§ Í±¥Î¨º ÎÇ¥ Ï£ºÏ∞®Îäî Ïñ¥Î†µÏäµÎãàÎã§. Ïù∏Í∑º Í≥µÏòÅÏ£ºÏ∞®Ïû•ÏùÑ Ïù¥Ïö©ÌïòÏãúÍ±∞ÎÇò ÎåÄÏ§ëÍµêÌÜµ Ïù¥Ïö©ÏùÑ Í∂åÏû•ÎìúÎ¶ΩÎãàÎã§.",
    faq2Q: "ÏòÅÏñ¥Î•º Ïûò Î™ªÌï¥ÎèÑ ÎêòÎÇòÏöî?",
    faq2A: "Î¨ºÎ°†ÏûÖÎãàÎã§! Ï§ëÏÉÅÍ∏â ÏßÄÌñ•Ïù¥ÏßÄÎßå, ÌãÄÎ¶¨Îäî Í≤ÉÏùÑ ÎëêÎ†§ÏõåÌïòÏßÄ ÏïäÍ≥† Ï¶êÍ≤ÅÍ≤å ÏÜåÌÜµÌïòÎ†§Îäî ÎßàÏùåÎßå ÏûàÎã§Î©¥ Ï∂©Î∂ÑÌï©ÎãàÎã§.",
    faq3Q: "Ï§ÄÎπÑÎ¨ºÏù¥ ÏûàÎÇòÏöî?",
    faq3A: "Í∞ÄÎ≤ºÏö¥ ÎßàÏùåÏúºÎ°ú Ïò§ÏãúÎ©¥ Îê©ÎãàÎã§. ÌïÑÏöîÌïú ÌïôÏäµ ÏûêÎ£åÎäî Î¶¨ÎçîÍ∞Ä Ï§ÄÎπÑÌï¥ ÎìúÎ¶ΩÎãàÎã§. Í∞úÏù∏ ÌïÑÍ∏∞Íµ¨ Ï†ïÎèÑÎßå Ï±ôÍ≤®Ï£ºÏÑ∏Ïöî."
  });

  // Form State
  const [name, setName] = useState('');
  const [nickname, setNickname] = useState('');
  const [contact, setContact] = useState('');
  const [gender, setGender] = useState('female'); 
  const [englishLevel, setEnglishLevel] = useState('mid'); 
  const [transferred, setTransferred] = useState(false);
  
  // UI State
  const [isAdmin, setIsAdmin] = useState(false);
  const [adminPinInput, setAdminPinInput] = useState('');
  const [showAdminLogin, setShowAdminLogin] = useState(false);
  const [loading, setLoading] = useState(false);
  const [errorMsg, setErrorMsg] = useState('');
  const [copied, setCopied] = useState(false);
  const [linkCopied, setLinkCopied] = useState(false);
  const [activeFaq, setActiveFaq] = useState(null); 
  const [activeEtiquette, setActiveEtiquette] = useState(null); 
  const [showCurriculum, setShowCurriculum] = useState(false); 
  const [dDay, setDDay] = useState('');

  // Custom UI States
  const [modalConfig, setModalConfig] = useState(null); 
  const [toast, setToast] = useState(null); 
  
  // Edit Info Modal State
  const [isEditingInfo, setIsEditingInfo] = useState(false);
  const [editForm, setEditForm] = useState({});

  // Constants
  const ADMIN_PIN = '1234'; 

  // --- Auth & Data Loading ---
  useEffect(() => {
    let mounted = true;
    const initAuth = async () => {
      try {
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
          await signInWithCustomToken(auth, __initial_auth_token); 
        } else {
          await signInAnonymously(auth);
        }
      } catch (error) {
        console.error("Authentication failed:", error);
      }
    };
    initAuth();
    
    const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
        if (mounted) setUser(currentUser);
    });
    return () => {
        mounted = false;
        unsubscribe();
    };
  }, []);

  // Fetch Attendees
  useEffect(() => {
    if (!user) return;
    const q = collection(db, 'artifacts', appId, 'public', 'data', ATTENDEES_COLLECTION);
    const unsubscribe = onSnapshot(q, (snapshot) => {
      const data = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      }));
      data.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
      setAttendees(data);
    }, (err) => console.error("Attendees fetch error", err));
    return () => unsubscribe();
  }, [user]);

  // Fetch Meetup Info & Calculate D-Day
  useEffect(() => {
    if (!user) return;
    const docRef = doc(db, 'artifacts', appId, 'public', 'data', CONFIG_COLLECTION, CONFIG_DOC_ID);
    const unsubscribe = onSnapshot(docRef, (docSnap) => {
      if (docSnap.exists()) {
        const data = docSnap.data();
        setMeetupInfo(prev => ({ ...prev, ...data }));
        
        // Calculate D-Day logic
        if (data.date) {
            try {
                const yearMatch = data.date.match(/(\d{4})ÎÖÑ/);
                const monthMatch = data.date.match(/(\d{1,2})Ïõî/);
                const dayMatch = data.date.match(/(\d{1,2})Ïùº/);
                
                if (yearMatch && monthMatch && dayMatch) {
                    const targetDate = new Date(yearMatch[1], monthMatch[1] - 1, dayMatch[1]);
                    const today = new Date();
                    targetDate.setHours(0,0,0,0);
                    today.setHours(0,0,0,0);
                    
                    const diffTime = targetDate - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 0) setDDay("D-Day");
                    else if (diffDays > 0) setDDay(`D-${diffDays}`);
                    else setDDay("End");
                }
            } catch(e) {
                console.error("Date parsing error", e);
            }
        }
      }
    }, (err) => console.error("Config fetch error", err));
    return () => unsubscribe();
  }, [user]);

  // --- Helper Functions ---
  const showToast = (message, type = 'success') => {
    setToast({ message, type });
    setTimeout(() => setToast(null), 3000);
  };

  const closeModal = () => setModalConfig(null);

  const toggleFaq = (idx) => {
    setActiveFaq(activeFaq === idx ? null : idx);
  };

  const toggleEtiquette = (idx) => {
    setActiveEtiquette(activeEtiquette === idx ? null : idx);
  };

  const copyToClipboard = (text) => {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    try {
      document.execCommand('copy');
      return true;
    } catch (err) {
      console.error('Copy failed', err);
      return false;
    } finally {
      document.body.removeChild(textArea);
    }
  };

  const handleShare = () => {
    const url = window.location.href;
    if (copyToClipboard(url)) {
        setLinkCopied(true);
        setTimeout(() => setLinkCopied(false), 2000);
        showToast("ÌéòÏù¥ÏßÄ ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!", "success");
    } else {
        showToast("ÎßÅÌÅ¨ Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.", "error");
    }
  };
  
  const handleCopyTopic = () => {
    const topicText = `[${meetupInfo.topicTitle}]\n\n${meetupInfo.session2Topic}\n"${meetupInfo.session2Question}"`;
    if (copyToClipboard(topicText)) {
        showToast("ÌÜ†Î°† Ï£ºÏ†úÍ∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!", "success");
    } else {
        showToast("Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.", "error");
    }
  };

  const handleCopyAccount = () => {
    const accountText = meetupInfo.bankAccount;
    if (copyToClipboard(accountText)) {
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
      showToast('Í≥ÑÏ¢åÎ≤àÌò∏Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§.', 'success');
    } else {
      showToast("Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.", "error");
    }
  };

  const generateRandomAvatar = () => {
    const randomSeed = Math.random().toString(36).substring(7);
    const newUrl = `https://api.dicebear.com/9.x/avataaars/svg?seed=${randomSeed}&backgroundColor=c0aede`;
    setEditForm({...editForm, leaderImage: newUrl});
  };

  const handleImageUpload = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    if (file.size > 500 * 1024) { 
      alert("Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞Í∞Ä ÎÑàÎ¨¥ ÌÅΩÎãàÎã§. 500KB Ïù¥ÌïòÏùò Ïù¥ÎØ∏ÏßÄÎ•º ÏÇ¨Ïö©Ìï¥Ï£ºÏÑ∏Ïöî.");
      return;
    }
    const reader = new FileReader();
    reader.onloadend = () => {
      setEditForm(prev => ({ ...prev, leaderImage: reader.result }));
    };
    reader.readAsDataURL(file);
  };
  
  // Helper for Date Parsing
  const getISODateFromKoreanString = (koreanDateString) => {
    try {
        const matches = koreanDateString.match(/(\d{4})ÎÖÑ\s*(\d{1,2})Ïõî\s*(\d{1,2})Ïùº/);
        if (matches) {
            const y = matches[1];
            const m = matches[2].padStart(2, '0');
            const d = matches[3].padStart(2, '0');
            return `${y}-${m}-${d}`;
        }
    } catch (e) {
        return '';
    }
    return '';
  };

  // --- Filtering ---
  const approvedList = attendees.filter(a => a.status === 'approved');
  const pendingList = attendees.filter(a => a.status === 'pending');
  const paidPendingCount = pendingList.filter(a => a.paid).length;
  const effectiveCount = approvedList.length + paidPendingCount;
  const currentMaxCapacity = parseInt(meetupInfo.maxCapacity) || 8;
  const isFull = effectiveCount >= currentMaxCapacity;

  // --- Handlers ---
  const handleApply = async (e) => {
    e.preventDefault();
    if (!name.trim()) return;

    const isWaitlist = effectiveCount >= currentMaxCapacity;

    if (!isWaitlist && !transferred) {
      setErrorMsg('Ï∞∏Í∞ÄÎπÑÎ•º ÏÜ°Í∏àÌïú ÌõÑ Ï≤¥ÌÅ¨Ìï¥Ï£ºÏÑ∏Ïöî.');
      return;
    }
    
    if (isWaitlist && !contact.trim()) {
        setErrorMsg('ÎåÄÍ∏∞ Ïã†Ï≤≠ Ïãú Ïó∞ÎùΩÏ≤ò ÏûÖÎ†•ÏùÄ ÌïÑÏàòÏûÖÎãàÎã§.');
        return;
    }

    setLoading(true);
    try {
      await addDoc(collection(db, 'artifacts', appId, 'public', 'data', ATTENDEES_COLLECTION), {
        name: name.trim(),
        nickname: nickname.trim(),
        contact: contact.trim(),
        gender: gender,
        englishLevel: englishLevel,
        status: 'pending', 
        isWaitlistApply: isWaitlist,
        paid: !isWaitlist, 
        createdAt: serverTimestamp(),
        userId: user.uid
      });
      setName('');
      setNickname('');
      setContact('');
      setGender('female');
      setEnglishLevel('mid');
      setTransferred(false);
      setErrorMsg('');
      
      if (isWaitlist) {
        showToast('ÎåÄÍ∏∞ÏûêÎ°ú Ïã†Ï≤≠ÎêòÏóàÏäµÎãàÎã§! Îπà ÏûêÎ¶¨Í∞Ä ÏÉùÍ∏∞Î©¥ Ïó∞ÎùΩÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.', 'info');
      } else {
        showToast('Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§! Î™ÖÎã®ÏóêÏÑú ÏÉÅÌÉúÎ•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.', 'success');
      }
    } catch (err) {
      console.error(err);
      showToast('Ïã†Ï≤≠ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
    } finally {
      setLoading(false);
    }
  };

  // --- Admin Actions ---
  const executeApprove = async (id) => {
    try {
      await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', ATTENDEES_COLLECTION, id), {
        status: 'approved',
        paid: true
      });
      showToast('ÏäπÏù∏ Ï≤òÎ¶¨Í∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.', 'success');
      closeModal();
    } catch (err) {
      console.error(err);
      showToast('ÏäπÏù∏ Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
    }
  };

  const handleApproveClick = (id) => {
    if (approvedList.length >= currentMaxCapacity) {
      setModalConfig({
        title: 'Ï†ïÏõê Ï¥àÍ≥º ÏäπÏù∏',
        message: `ÌòÑÏû¨ ÌôïÏ†ïÎêú Ïù∏ÏõêÏù¥ Ïù¥ÎØ∏ Ï†ïÏõê(${currentMaxCapacity}Î™Ö)ÏûÖÎãàÎã§. Í∑∏ÎûòÎèÑ Ï∂îÍ∞Ä ÏäπÏù∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`,
        confirmText: 'Ï∂îÍ∞Ä ÏäπÏù∏',
        isDestructive: false,
        onConfirm: () => executeApprove(id)
      });
    } else {
      executeApprove(id);
    }
  };

  const executeDelete = async (id) => {
    try {
      await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', ATTENDEES_COLLECTION, id));
      showToast('ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', 'success');
      closeModal();
    } catch (err) {
      console.error(err);
      showToast('ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
    }
  };

  const handleDeleteClick = (id) => {
    setModalConfig({
      title: 'Ï∞∏Í∞Ä ÎÇ¥Ïó≠ ÏÇ≠Ï†ú',
      message: 'Ï†ïÎßê ÏÇ≠Ï†ú(Í±∞Ï†à/Ï∑®ÏÜå) ÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.',
      confirmText: 'ÏÇ≠Ï†úÌïòÍ∏∞',
      isDestructive: true,
      onConfirm: () => executeDelete(id)
    });
  };

  const toggleAdmin = () => {
    if (isAdmin) {
      setIsAdmin(false);
      setAdminPinInput('');
      showToast('Í¥ÄÎ¶¨Ïûê Î™®ÎìúÍ∞Ä Ï¢ÖÎ£åÎêòÏóàÏäµÎãàÎã§.', 'info');
    } else {
      setShowAdminLogin(!showAdminLogin);
    }
  };

  const verifyPin = () => {
    if (adminPinInput === ADMIN_PIN) {
      setIsAdmin(true);
      setShowAdminLogin(false);
      setAdminPinInput('');
      showToast('Í¥ÄÎ¶¨ÏûêÎãò ÌôòÏòÅÌï©ÎãàÎã§.', 'success');
    } else {
      showToast('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§.', 'error');
    }
  };

  // --- Edit Info Actions ---
  const openEditModal = () => {
    setEditForm({ ...meetupInfo });
    setIsEditingInfo(true);
  };

  const saveInfo = async () => {
    try {
      await setDoc(doc(db, 'artifacts', appId, 'public', 'data', CONFIG_COLLECTION, CONFIG_DOC_ID), editForm);
      setIsEditingInfo(false);
      showToast('Î™®ÏûÑ ÏÑ§Ï†ïÏù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.', 'success');
    } catch (err) {
      console.error(err);
      showToast('ÏÑ§Ï†ï ÏàòÏ†ï Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
    }
  };

  return (
    <div className="min-h-screen bg-slate-50 font-sans text-slate-800 pb-20 relative">
      {/* Toast Notification */}
      {toast && (
        <div className="fixed top-4 left-1/2 transform -translate-x-1/2 z-[60] animate-in fade-in slide-in-from-top-5 duration-300 w-full max-w-sm px-4">
          <div className={`shadow-lg rounded-lg p-4 flex items-center gap-3 text-white font-medium ${
            toast.type === 'error' ? 'bg-red-500' : 
            toast.type === 'info' ? 'bg-indigo-500' : 'bg-emerald-500'
          }`}>
            {toast.type === 'error' ? <AlertCircle size={20} /> : 
             toast.type === 'info' ? <Info size={20} /> : <CheckCircle size={20} />}
            {toast.message}
          </div>
        </div>
      )}

      {/* Confirmation Modal */}
      {modalConfig && (
        <div className="fixed inset-0 bg-black/60 z-[70] flex items-center justify-center p-4 animate-in fade-in duration-200">
          <div className="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden transform scale-100 transition-all">
            <div className="p-6">
              <div className="flex items-center gap-3 mb-4">
                <div className={`p-3 rounded-full ${modalConfig.isDestructive ? 'bg-red-100 text-red-600' : 'bg-amber-100 text-amber-600'}`}>
                  <AlertTriangle size={24} />
                </div>
                <h3 className="text-lg font-bold text-slate-900">{modalConfig.title}</h3>
              </div>
              <p className="text-slate-600 mb-6 leading-relaxed">
                {modalConfig.message}
              </p>
              <div className="flex gap-3">
                <button 
                  onClick={closeModal}
                  className="flex-1 py-2.5 px-4 bg-slate-100 text-slate-700 font-bold rounded-lg hover:bg-slate-200 transition-colors"
                >
                  Ï∑®ÏÜå
                </button>
                <button 
                  onClick={modalConfig.onConfirm}
                  className={`flex-1 py-2.5 px-4 text-white font-bold rounded-lg transition-colors shadow-sm ${
                    modalConfig.isDestructive ? 'bg-red-500 hover:bg-red-600' : 'bg-indigo-600 hover:bg-indigo-700'
                  }`}
                >
                  {modalConfig.confirmText}
                </button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Edit Info Modal */}
      {isEditingInfo && (
        <div className="fixed inset-0 bg-black/60 z-[70] flex items-end sm:items-center justify-center p-0 sm:p-4 animate-in fade-in duration-200">
          <div className="bg-white rounded-t-xl sm:rounded-xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]">
            <div className="p-5 border-b border-slate-100 bg-slate-50 flex justify-between items-center shrink-0">
              <h3 className="font-bold text-lg flex items-center gap-2">
                <Settings size={20} className="text-indigo-600" /> Î™®ÏûÑ ÏÑ§Ï†ï & Ï†ïÎ≥¥ ÏàòÏ†ï
              </h3>
              <button onClick={() => setIsEditingInfo(false)} className="text-slate-400 hover:text-slate-600">
                <XCircle size={24} />
              </button>
            </div>
            
            <div className="p-6 overflow-y-auto space-y-6">
              
              {/* Section 1: Header */}
              <div className="space-y-3">
                <h4 className="font-bold text-indigo-700 border-b pb-1">1. Ìó§Îçî ÏÑ§Ï†ï (Header)</h4>
                <div>
                  <label className="block text-xs font-bold text-slate-500 mb-1">Î™®ÏûÑ Ïù¥Î¶Ñ</label>
                  <input type="text" className="w-full p-2 border rounded" value={editForm.clubName} onChange={e => setEditForm({...editForm, clubName: e.target.value})} />
                </div>
                <div>
                  <label className="block text-xs font-bold text-slate-500 mb-1">ÌÉÄÏù¥ÌãÄ</label>
                  <input type="text" className="w-full p-2 border rounded" value={editForm.meetupTitle} onChange={e => setEditForm({...editForm, meetupTitle: e.target.value})} />
                </div>
                <div>
                  <label className="block text-xs font-bold text-slate-500 mb-1">Î™®ÏûÑ ÏÑ§Î™Ö (Description)</label>
                  <textarea 
                    className="w-full p-2 border rounded h-16 text-sm" 
                    value={editForm.meetupDesc} 
                    onChange={e => setEditForm({...editForm, meetupDesc: e.target.value})} 
                  />
                </div>
              </div>

              {/* Section 2: Basic Info */}
              <div className="space-y-3">
                <h4 className="font-bold text-indigo-700 border-b pb-1">2. Í∏∞Î≥∏ Ï†ïÎ≥¥ (Basic Info)</h4>
                <div className="grid grid-cols-2 gap-2">
                   <div>
                      <label className="block text-xs font-bold text-slate-500 mb-1">ÎÇ†Ïßú (Date)</label>
                      <div className="flex gap-2 items-center">
                        <input 
                            type="text" 
                            className="flex-1 p-2 border rounded" 
                            value={editForm.date} 
                            onChange={e => setEditForm({...editForm, date: e.target.value})} 
                        />
                        <div className="relative">
                            <input 
                                type="date" 
                                className="absolute opacity-0 inset-0 w-full h-full cursor-pointer"
                                value={getISODateFromKoreanString(editForm.date)}
                                onChange={(e) => {
                                    if(!e.target.value) return;
                                    const d = new Date(e.target.value);
                                    const days = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
                                    const formatted = `${d.getFullYear()}ÎÖÑ ${d.getMonth() + 1}Ïõî ${d.getDate()}Ïùº (${days[d.getDay()]})`;
                                    setEditForm(prev => ({...prev, date: formatted}));
                                }}
                            />
                            <button className="p-2 bg-slate-100 border rounded text-slate-600 hover:bg-slate-200">
                                <Calendar size={18} />
                            </button>
                        </div>
                      </div>
                   </div>
                   <div>
                      <label className="block text-xs font-bold text-slate-500 mb-1">ÏãúÍ∞Ñ (Time)</label>
                      <input type="text" className="w-full p-2 border rounded" value={editForm.time} onChange={e => setEditForm({...editForm, time: e.target.value})} />
                   </div>
                </div>
                <div className="grid grid-cols-2 gap-2">
                   <div>
                      <label className="block text-xs font-bold text-slate-500 mb-1">Ïû•ÏÜåÎ™Ö</label>
                      <input type="text" className="w-full p-2 border rounded" value={editForm.locationName} onChange={e => setEditForm({...editForm, locationName: e.target.value})} />
                   </div>
                   <div>
                      <label className="block text-xs font-bold text-slate-500 mb-1">ÏÉÅÏÑ∏ Ï£ºÏÜå</label>
                      <input type="text" className="w-full p-2 border rounded" value={editForm.locationAddress} onChange={e => setEditForm({...editForm, locationAddress: e.target.value})} />
                   </div>
                </div>
                <div>
                  <label className="block text-xs font-bold text-slate-500 mb-1">ÏßÄÎèÑ ÎßÅÌÅ¨ (Naver Map Link)</label>
                  <input type="text" className="w-full p-2 border rounded text-xs" value={editForm.locationLink} onChange={e => setEditForm({...editForm, locationLink: e.target.value})} />
                </div>
              </div>

              {/* Section 3: Operational */}
              <div className="space-y-3">
                <h4 className="font-bold text-indigo-700 border-b pb-1">3. Ïö¥ÏòÅ ÏÑ§Ï†ï (Operations)</h4>
                <div className="grid grid-cols-2 gap-2">
                   <div>
                      <label className="block text-xs font-bold text-slate-500 mb-1">ÏµúÎåÄ Ï†ïÏõê (Ïà´ÏûêÎßå)</label>
                      <input type="number" className="w-full p-2 border rounded" value={editForm.maxCapacity} onChange={e => setEditForm({...editForm, maxCapacity: e.target.value})} />
                   </div>
                   <div>
                      <label className="block text-xs font-bold text-slate-500 mb-1">Ï∞∏Í∞ÄÎπÑ (Ïõê Îã®ÏúÑ)</label>
                      <input type="text" className="w-full p-2 border rounded" value={editForm.fee} onChange={e => setEditForm({...editForm, fee: e.target.value})} />
                   </div>
                   <div>
                      <label className="block text-xs font-bold text-slate-500 mb-1">ÏõêÎûò Ï∞∏Í∞ÄÎπÑ (Ï∑®ÏÜåÏÑ†)</label>
                      <input type="text" className="w-full p-2 border rounded" value={editForm.originalFee} onChange={e => setEditForm({...editForm, originalFee: e.target.value})} />
                   </div>
                </div>
                <div>
                    <label className="block text-xs font-bold text-slate-500 mb-1">ÏùåÎ£å Ï†ïÏ±Ö Î¨∏Íµ¨</label>
                    <input type="text" className="w-full p-2 border rounded" value={editForm.drinkPolicy} onChange={e => setEditForm({...editForm, drinkPolicy: e.target.value})} />
                </div>
                <div className="grid grid-cols-3 gap-2">
                   <div>
                      <label className="block text-xs font-bold text-slate-500 mb-1">ÏùÄÌñâÎ™Ö</label>
                      <input type="text" className="w-full p-2 border rounded" value={editForm.bankName} onChange={e => setEditForm({...editForm, bankName: e.target.value})} />
                   </div>
                   <div className="col-span-2">
                      <label className="block text-xs font-bold text-slate-500 mb-1">Í≥ÑÏ¢åÎ≤àÌò∏</label>
                      <input type="text" className="w-full p-2 border rounded" value={editForm.bankAccount} onChange={e => setEditForm({...editForm, bankAccount: e.target.value})} />
                   </div>
                </div>
                <div>
                    <label className="block text-xs font-bold text-slate-500 mb-1">ÏòàÍ∏àÏ£º</label>
                    <input type="text" className="w-full p-2 border rounded" value={editForm.accountHolder} onChange={e => setEditForm({...editForm, accountHolder: e.target.value})} />
                </div>
              </div>

              {/* Section 4: Schedule */}
              <div className="space-y-3">
                <h4 className="font-bold text-indigo-700 border-b pb-1">4. Ïä§ÏºÄÏ§Ñ ÏÉÅÏÑ∏ (Session Details)</h4>
                
                {/* Session 1 */}
                <div className="bg-slate-50 p-3 rounded border border-slate-200">
                  <h5 className="font-bold text-sm mb-2 text-slate-700">Part 1</h5>
                  <div className="grid grid-cols-2 gap-2 mb-2">
                    <input type="text" placeholder="Title" className="p-2 border rounded text-xs" value={editForm.session1Title} onChange={e => setEditForm({...editForm, session1Title: e.target.value})} />
                    <input type="text" placeholder="Duration" className="p-2 border rounded text-xs" value={editForm.session1Duration} onChange={e => setEditForm({...editForm, session1Duration: e.target.value})} />
                  </div>
                  
                  {/* Item 1 */}
                  <div className="space-y-1 border-b border-slate-100 pb-2 mb-2">
                     <div className="flex gap-2">
                        <input type="text" placeholder="Time" className="w-16 p-2 border rounded text-xs" value={editForm.p1Time1} onChange={e => setEditForm({...editForm, p1Time1: e.target.value})} />
                        <input type="text" placeholder="Activity Title" className="flex-1 p-2 border rounded text-xs" value={editForm.p1Title1} onChange={e => setEditForm({...editForm, p1Title1: e.target.value})} />
                     </div>
                     <textarea placeholder="Description" className="w-full p-2 border rounded text-xs h-12" value={editForm.p1Desc1} onChange={e => setEditForm({...editForm, p1Desc1: e.target.value})} />
                  </div>
                  {/* Item 2 */}
                  <div className="space-y-1 border-b border-slate-100 pb-2 mb-2">
                     <div className="flex gap-2">
                        <input type="text" placeholder="Time" className="w-16 p-2 border rounded text-xs" value={editForm.p1Time2} onChange={e => setEditForm({...editForm, p1Time2: e.target.value})} />
                        <input type="text" placeholder="Activity Title" className="flex-1 p-2 border rounded text-xs" value={editForm.p1Title2} onChange={e => setEditForm({...editForm, p1Title2: e.target.value})} />
                     </div>
                     <textarea placeholder="Description" className="w-full p-2 border rounded text-xs h-12" value={editForm.p1Desc2} onChange={e => setEditForm({...editForm, p1Desc2: e.target.value})} />
                  </div>
                  {/* Item 3 */}
                  <div className="space-y-1">
                     <div className="flex gap-2">
                        <input type="text" placeholder="Time" className="w-16 p-2 border rounded text-xs" value={editForm.p1Time3} onChange={e => setEditForm({...editForm, p1Time3: e.target.value})} />
                        <input type="text" placeholder="Activity Title" className="flex-1 p-2 border rounded text-xs" value={editForm.p1Title3} onChange={e => setEditForm({...editForm, p1Title3: e.target.value})} />
                     </div>
                     <textarea placeholder="Description" className="w-full p-2 border rounded text-xs h-12" value={editForm.p1Desc3} onChange={e => setEditForm({...editForm, p1Desc3: e.target.value})} />
                  </div>
                </div>

                {/* Break */}
                <div className="bg-amber-50 p-2 rounded border border-amber-100">
                   <p className="text-xs font-bold text-amber-700 mb-1">Intermission</p>
                   <input type="text" className="w-full p-2 border rounded text-xs mb-1" value={editForm.breakTitle} onChange={e => setEditForm({...editForm, breakTitle: e.target.value})} />
                   <textarea className="w-full p-2 border rounded text-xs h-10" value={editForm.breakDesc} onChange={e => setEditForm({...editForm, breakDesc: e.target.value})} />
                </div>

                {/* Session 2 */}
                <div className="bg-slate-50 p-3 rounded border border-slate-200">
                  <h5 className="font-bold text-sm mb-2 text-slate-700">Part 2</h5>
                  <div className="grid grid-cols-2 gap-2 mb-2">
                    <input type="text" placeholder="Title" className="p-2 border rounded text-xs" value={editForm.part2Title} onChange={e => setEditForm({...editForm, part2Title: e.target.value})} />
                    <input type="text" placeholder="Duration" className="p-2 border rounded text-xs" value={editForm.part2Duration} onChange={e => setEditForm({...editForm, part2Duration: e.target.value})} />
                  </div>

                  {/* Item 1 */}
                  <div className="space-y-1 border-b border-slate-100 pb-2 mb-2">
                     <div className="flex gap-2">
                        <input type="text" placeholder="Time" className="w-16 p-2 border rounded text-xs" value={editForm.p2Time1} onChange={e => setEditForm({...editForm, p2Time1: e.target.value})} />
                        <input type="text" placeholder="Activity Title" className="flex-1 p-2 border rounded text-xs" value={editForm.p2Title1} onChange={e => setEditForm({...editForm, p2Title1: e.target.value})} />
                     </div>
                     <textarea placeholder="Description" className="w-full p-2 border rounded text-xs h-12" value={editForm.p2Desc1} onChange={e => setEditForm({...editForm, p2Desc1: e.target.value})} />
                  </div>
                  {/* Item 2 */}
                  <div className="space-y-1 border-b border-slate-100 pb-2 mb-2">
                     <div className="flex gap-2">
                        <input type="text" placeholder="Time" className="w-16 p-2 border rounded text-xs" value={editForm.p2Time2} onChange={e => setEditForm({...editForm, p2Time2: e.target.value})} />
                        <input type="text" placeholder="Activity Title" className="flex-1 p-2 border rounded text-xs" value={editForm.p2Title2} onChange={e => setEditForm({...editForm, p2Title2: e.target.value})} />
                     </div>
                     <textarea placeholder="Description" className="w-full p-2 border rounded text-xs h-12" value={editForm.p2Desc2} onChange={e => setEditForm({...editForm, p2Desc2: e.target.value})} />
                  </div>
                  {/* Item 3 */}
                  <div className="space-y-1">
                     <div className="flex gap-2">
                        <input type="text" placeholder="Time" className="w-16 p-2 border rounded text-xs" value={editForm.p2Time3} onChange={e => setEditForm({...editForm, p2Time3: e.target.value})} />
                        <input type="text" placeholder="Activity Title" className="flex-1 p-2 border rounded text-xs" value={editForm.p2Title3} onChange={e => setEditForm({...editForm, p2Title3: e.target.value})} />
                     </div>
                     <textarea placeholder="Description" className="w-full p-2 border rounded text-xs h-12" value={editForm.p2Desc3} onChange={e => setEditForm({...editForm, p2Desc3: e.target.value})} />
                  </div>
                </div>
              </div>

              {/* Section 5: Topics */}
              <div className="space-y-3">
                <h4 className="font-bold text-indigo-700 border-b pb-1">5. ÌÜ†ÌîΩ ÎÇ¥Ïö© (Topics)</h4>
                <div>
                  <label className="block text-xs font-bold text-slate-500 mb-1">Î©îÏù∏ Ï£ºÏ†ú (Main Topic)</label>
                  <input type="text" className="w-full p-2 border rounded" value={editForm.topicTitle} onChange={e => setEditForm({...editForm, topicTitle: e.target.value})} />
                </div>
                <div>
                  <label className="block text-xs font-bold text-slate-500 mb-1">Session 2 ÌÜ†Î°† Ï£ºÏ†ú</label>
                  <input type="text" className="w-full p-2 border rounded" value={editForm.session2Topic} onChange={e => setEditForm({...editForm, session2Topic: e.target.value})} />
                </div>
                <div>
                  <label className="block text-xs font-bold text-slate-500 mb-1">Session 2 ÌÜ†Î°† ÏßàÎ¨∏/ÏòàÎ¨∏</label>
                  <textarea className="w-full p-2 border rounded h-24 text-sm" value={editForm.session2Question} onChange={e => setEditForm({...editForm, session2Question: e.target.value})} />
                </div>
              </div>

              {/* Section 6: Leader Info */}
              <div className="space-y-3">
                <h4 className="font-bold text-indigo-700 border-b pb-1">6. Î¶¨Îçî ÏÜåÍ∞ú (Leader Profile)</h4>
                <div>
                  <label className="block text-xs font-bold text-slate-500 mb-1">Î¶¨Îçî Ïù¥Î¶Ñ</label>
                  <input type="text" className="w-full p-2 border rounded" value={editForm.leaderName} onChange={e => setEditForm({...editForm, leaderName: e.target.value})} />
                </div>
                <div>
                  <label className="block text-xs font-bold text-slate-500 mb-1 flex items-center gap-1">
                    <ImageIcon size={12}/> ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ URL
                  </label>
                  
                  {/* Image URL Input + Random + File Upload */}
                  <div className="space-y-2">
                    <div className="flex gap-2">
                        <input 
                            type="text" 
                            className="w-full p-2 border rounded text-xs bg-slate-50" 
                            value={editForm.leaderImage} 
                            onChange={e => setEditForm({...editForm, leaderImage: e.target.value})} 
                            placeholder="Ïù¥ÎØ∏ÏßÄ Ï£ºÏÜå(URL) ÏßÅÏ†ë ÏûÖÎ†•"
                        />
                        <button 
                            onClick={generateRandomAvatar}
                            className="p-2 bg-indigo-50 border border-indigo-200 rounded hover:bg-indigo-100 text-indigo-600 transition-colors"
                            title="ÎûúÎç§ ÏïÑÎ∞îÌÉÄ ÏÉùÏÑ±"
                        >
                            <RefreshCw size={16} />
                        </button>
                    </div>

                    <div className="flex items-center gap-2">
                        <label className="flex-1 cursor-pointer bg-white border border-slate-300 rounded p-2 text-xs flex items-center justify-center gap-2 hover:bg-slate-50 transition-colors">
                            <Upload size={14} className="text-slate-500"/>
                            <span className="text-slate-600">ÎÇ¥ Ïª¥Ìì®ÌÑ∞ÏóêÏÑú Ïù¥ÎØ∏ÏßÄ ÏÑ†ÌÉù (500KB Ïù¥Ìïò)</span>
                            <input 
                                type="file" 
                                accept="image/*" 
                                onChange={handleImageUpload} 
                                className="hidden" 
                            />
                        </label>
                    </div>
                  </div>
                  <p className="text-[10px] text-slate-400 mt-1">‚Äª Ï†ïÏÇ¨Í∞ÅÌòï ÎπÑÏú® Í∂åÏû•. URL ÏûÖÎ†• ÎòêÎäî ÌååÏùº ÏóÖÎ°úÎìú Ï§ë Ìé∏Ìïú Î∞©Î≤ïÏùÑ ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.</p>
                </div>
                <div>
                  <label className="block text-xs font-bold text-slate-500 mb-1">ÏÜåÍ∞úÍ∏Ä (Bio)</label>
                  <textarea className="w-full p-2 border rounded h-32 text-sm" value={editForm.leaderBio} onChange={e => setEditForm({...editForm, leaderBio: e.target.value})} />
                </div>
                <div>
                  <label className="block text-xs font-bold text-slate-500 mb-1">ÌÉúÍ∑∏/Í≤ΩÎ†• (ÏâºÌëúÎ°ú Íµ¨Î∂Ñ)</label>
                  <input type="text" className="w-full p-2 border rounded" value={editForm.leaderTags} onChange={e => setEditForm({...editForm, leaderTags: e.target.value})} />
                </div>
              </div>

              {/* Section 7: Etiquette (New in Modal) */}
              <div className="space-y-3">
                <h4 className="font-bold text-indigo-700 border-b pb-1">7. ÏóêÌã∞Ïºì ÏÑ§Ï†ï</h4>
                <div>
                  <label className="block text-xs font-bold text-slate-500 mb-1">ÏÑπÏÖò Ï†úÎ™©</label>
                  <input type="text" className="w-full p-2 border rounded" value={editForm.etiquetteTitle} onChange={e => setEditForm({...editForm, etiquetteTitle: e.target.value})} />
                </div>
                <div className="bg-slate-50 p-2 rounded">
                  <p className="text-xs font-bold text-slate-500 mb-2">ÏïΩÏÜç 1</p>
                  <input type="text" placeholder="Ï†úÎ™©" className="w-full p-2 border rounded mb-1 text-sm" value={editForm.etiquette1Title} onChange={e => setEditForm({...editForm, etiquette1Title: e.target.value})} />
                  <textarea placeholder="ÎÇ¥Ïö©" className="w-full p-2 border rounded text-sm h-16" value={editForm.etiquette1Desc} onChange={e => setEditForm({...editForm, etiquette1Desc: e.target.value})} />
                </div>
                <div className="bg-slate-50 p-2 rounded">
                  <p className="text-xs font-bold text-slate-500 mb-2">ÏïΩÏÜç 2</p>
                  <input type="text" placeholder="Ï†úÎ™©" className="w-full p-2 border rounded mb-1 text-sm" value={editForm.etiquette2Title} onChange={e => setEditForm({...editForm, etiquette2Title: e.target.value})} />
                  <textarea placeholder="ÎÇ¥Ïö©" className="w-full p-2 border rounded text-sm h-16" value={editForm.etiquette2Desc} onChange={e => setEditForm({...editForm, etiquette2Desc: e.target.value})} />
                </div>
                <div className="bg-slate-50 p-2 rounded">
                  <p className="text-xs font-bold text-slate-500 mb-2">ÏïΩÏÜç 3</p>
                  <input type="text" placeholder="Ï†úÎ™©" className="w-full p-2 border rounded mb-1 text-sm" value={editForm.etiquette3Title} onChange={e => setEditForm({...editForm, etiquette3Title: e.target.value})} />
                  <textarea placeholder="ÎÇ¥Ïö©" className="w-full p-2 border rounded text-sm h-16" value={editForm.etiquette3Desc} onChange={e => setEditForm({...editForm, etiquette3Desc: e.target.value})} />
                </div>
              </div>

              {/* Section 8: FAQ & Contact */}
              <div className="space-y-3">
                <h4 className="font-bold text-indigo-700 border-b pb-1">8. Î¨∏Ïùò Î∞è FAQ</h4>
                <div>
                  <label className="block text-xs font-bold text-slate-500 mb-1">Ïπ¥Ïπ¥Ïò§ÌÜ° Ïò§ÌîàÏ±ÑÌåÖ ÎßÅÌÅ¨</label>
                  <input type="text" className="w-full p-2 border rounded" value={editForm.openChatLink} onChange={e => setEditForm({...editForm, openChatLink: e.target.value})} />
                </div>
                <div className="bg-slate-50 p-2 rounded">
                  <p className="text-xs font-bold text-slate-500 mb-2">FAQ 1</p>
                  <input type="text" placeholder="ÏßàÎ¨∏" className="w-full p-2 border rounded mb-1 text-sm" value={editForm.faq1Q} onChange={e => setEditForm({...editForm, faq1Q: e.target.value})} />
                  <textarea placeholder="ÎãµÎ≥Ä" className="w-full p-2 border rounded text-sm h-16" value={editForm.faq1A} onChange={e => setEditForm({...editForm, faq1A: e.target.value})} />
                </div>
                <div className="bg-slate-50 p-2 rounded">
                  <p className="text-xs font-bold text-slate-500 mb-2">FAQ 2</p>
                  <input type="text" placeholder="ÏßàÎ¨∏" className="w-full p-2 border rounded mb-1 text-sm" value={editForm.faq2Q} onChange={e => setEditForm({...editForm, faq2Q: e.target.value})} />
                  <textarea placeholder="ÎãµÎ≥Ä" className="w-full p-2 border rounded text-sm h-16" value={editForm.faq2A} onChange={e => setEditForm({...editForm, faq2A: e.target.value})} />
                </div>
                <div className="bg-slate-50 p-2 rounded">
                  <p className="text-xs font-bold text-slate-500 mb-2">FAQ 3</p>
                  <input type="text" placeholder="ÏßàÎ¨∏" className="w-full p-2 border rounded mb-1 text-sm" value={editForm.faq3Q} onChange={e => setEditForm({...editForm, faq3Q: e.target.value})} />
                  <textarea placeholder="ÎãµÎ≥Ä" className="w-full p-2 border rounded text-sm h-16" value={editForm.faq3A} onChange={e => setEditForm({...editForm, faq3A: e.target.value})} />
                </div>
              </div>

              {/* Section 9: Rules (New) */}
              <div className="space-y-3">
                 <h4 className="font-bold text-indigo-700 border-b pb-1">9. ÏßÑÌñâ Í∑úÏπô (Participation Rules)</h4>
                 <div>
                    <label className="block text-xs font-bold text-slate-500 mb-1">Í∑úÏπô 1 (Facilitator System)</label>
                    <textarea className="w-full p-2 border rounded text-sm h-12" value={editForm.rule1} onChange={e => setEditForm({...editForm, rule1: e.target.value})} />
                 </div>
                 <div>
                    <label className="block text-xs font-bold text-slate-500 mb-1">Í∑úÏπô 2 (Repetitive Learning)</label>
                    <textarea className="w-full p-2 border rounded text-sm h-12" value={editForm.rule2} onChange={e => setEditForm({...editForm, rule2: e.target.value})} />
                 </div>
                 <div>
                    <label className="block text-xs font-bold text-slate-500 mb-1">Í∑úÏπô 3 (Focus on Fluency)</label>
                    <textarea className="w-full p-2 border rounded text-sm h-12" value={editForm.rule3} onChange={e => setEditForm({...editForm, rule3: e.target.value})} />
                 </div>
              </div>

            </div>

            <div className="p-4 border-t border-slate-100 bg-slate-50 flex gap-2 shrink-0">
              <button 
                onClick={() => setIsEditingInfo(false)}
                className="flex-1 py-3 bg-white border border-slate-300 text-slate-700 font-bold rounded-lg hover:bg-slate-50"
              >
                Ï∑®ÏÜå
              </button>
              <button 
                onClick={saveInfo}
                className="flex-1 py-3 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 flex items-center justify-center gap-2"
              >
                <Save size={18} /> ÏÑ§Ï†ï Ï†ÄÏû•
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Header */}
      <header className="bg-indigo-600 text-white p-6 shadow-lg">
        <div className="max-w-3xl mx-auto flex justify-between items-start">
          <div>
            <h1 className="text-3xl font-bold mb-2">{meetupInfo.clubName}</h1>
            <p className="opacity-90 font-medium text-lg mb-2 flex items-center gap-2">
              {dDay && (
                  <span className={`text-xs font-extrabold px-2 py-1 rounded shadow-sm ${dDay === 'End' ? 'bg-slate-200 text-slate-500' : 'bg-white text-red-600'}`}>
                      {dDay}
                  </span>
              )}
              {meetupInfo.meetupTitle}
            </p>
            <p className="text-indigo-100 text-sm leading-relaxed max-w-xl">
              {meetupInfo.meetupDesc}
            </p>
          </div>
          {isAdmin && (
            <button 
              onClick={openEditModal}
              className="bg-white/10 hover:bg-white/20 text-white p-2 rounded-lg backdrop-blur-sm transition-colors"
              title="Î™®ÏûÑ Ï†ïÎ≥¥ Î∞è ÏÑ§Ï†ï ÏàòÏ†ï"
            >
              <Settings size={20} />
            </button>
          )}
        </div>
      </header>

      <main className="max-w-3xl mx-auto p-4 space-y-6 -mt-6">
        
        {/* Info Cards */}
        <div className="grid md:grid-cols-2 gap-4">
          <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-100 flex items-start gap-4">
            <div className="bg-indigo-100 p-3 rounded-full text-indigo-600 shrink-0">
              <Calendar size={24} />
            </div>
            <div>
              <h3 className="font-semibold text-slate-500 text-sm uppercase">Date & Time</h3>
              <p className="font-bold text-lg">{meetupInfo.date}</p>
              <p className="text-indigo-600 font-medium">{meetupInfo.time}</p>
            </div>
          </div>
          
          <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-100 flex items-start gap-4">
            <div className="bg-emerald-100 p-3 rounded-full text-emerald-600 shrink-0">
              <MapPin size={24} />
            </div>
            <div className="flex-1">
              <h3 className="font-semibold text-slate-500 text-sm uppercase">Location</h3>
              <p className="font-bold text-lg">{meetupInfo.locationName}</p>
              <p className="text-slate-500 text-sm mb-2">{meetupInfo.locationAddress}</p>
              <a 
                href={meetupInfo.locationLink || "#"}
                target="_blank" 
                rel="noreferrer"
                className="inline-flex items-center gap-1 text-xs font-bold bg-emerald-50 text-emerald-600 px-2 py-1 rounded hover:bg-emerald-100 transition-colors"
              >
                <ExternalLink size={12} /> ÎÑ§Ïù¥Î≤Ñ ÏßÄÎèÑ Î≥¥Í∏∞
              </a>
            </div>
          </div>
        </div>

        {/* Leader Profile Section */}
        {meetupInfo.leaderName && (
          <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
            <div className="bg-gradient-to-r from-indigo-50 to-white p-4 flex items-center gap-2 border-b border-indigo-50">
              <Award size={20} className="text-indigo-600" />
              <h2 className="font-bold text-lg text-indigo-900">Meet Your Host</h2>
            </div>
            <div className="p-6 flex flex-col sm:flex-row gap-6 items-stretch">
              <div className="shrink-0 flex flex-col items-center justify-center w-full sm:w-48 bg-slate-50 rounded-xl p-4 border border-slate-100">
                <div className="w-full aspect-square rounded-xl overflow-hidden border-4 border-white shadow-md mb-3">
                  <img 
                    src={meetupInfo.leaderImage || "https://api.dicebear.com/9.x/avataaars/svg?seed=Jett"} 
                    alt="Leader" 
                    className="w-full h-full object-cover"
                    onError={(e) => {
                        e.target.onerror = null; 
                        e.target.src="https://api.dicebear.com/9.x/avataaars/svg?seed=Fallback";
                    }}
                  />
                </div>
                <div className="text-center w-full">
                  <p className="font-bold text-xl text-slate-800 break-words">{meetupInfo.leaderName}</p>
                  <p className="text-xs text-indigo-600 font-bold bg-indigo-100 px-2 py-0.5 rounded-full inline-block mt-1">
                    English Meetup Leader
                  </p>
                </div>
              </div>
              
              <div className="flex-1 flex flex-col justify-center space-y-5">
                <div className="text-sm text-slate-600 leading-relaxed whitespace-pre-wrap">
                   {meetupInfo.leaderBio}
                </div>

                {meetupInfo.leaderTags && (
                  <div>
                    <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 flex items-center gap-1">
                      <Activity size={12}/> Background & Experience
                    </h3>
                    <div className="flex flex-wrap gap-2">
                      {meetupInfo.leaderTags.split(',').map((tag, idx) => (
                        <span key={idx} className="bg-white text-slate-700 text-xs px-3 py-1.5 rounded-lg font-medium border border-slate-200 shadow-sm flex items-center gap-1.5 transition-transform hover:-translate-y-0.5">
                          {idx === 0 ? <Award size={12} className="text-amber-500"/> : <CheckCircle size={12} className="text-indigo-400"/>}
                          {tag.trim()}
                        </span>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        )}

        {/* Topic Section */}
        <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
          <div className="bg-indigo-50 p-4 flex items-center gap-2 border-b border-indigo-100">
            <MessageCircle size={20} className="text-indigo-600" />
            <h2 className="font-bold text-lg text-indigo-900">This week's Topic</h2>
            <button 
                onClick={handleCopyTopic}
                className="ml-auto text-xs bg-white text-indigo-600 border border-indigo-200 px-2 py-1 rounded flex items-center gap-1 hover:bg-indigo-50 transition-colors"
            >
              <Copy size={12} /> ÌÜ†ÌîΩ Î≥µÏÇ¨
            </button>
          </div>
          
          <div className="p-5">
            {/* Discussion Questions Box - Moved Here */}
            <div className="bg-slate-50 p-4 rounded-lg border border-slate-200 mb-8">
              <h4 className="font-bold text-indigo-600 text-sm mb-2">Today's Debate Topic</h4>
              <p className="text-slate-700 text-sm italic whitespace-pre-wrap">
                "{meetupInfo.session2Question}"
              </p>
            </div>

            <button 
              onClick={() => setShowCurriculum(!showCurriculum)}
              className="w-full flex items-center justify-between p-3 bg-indigo-50 text-indigo-700 font-bold rounded-lg border border-indigo-100 hover:bg-indigo-100 transition-colors mb-4"
            >
              <span className="flex items-center gap-2">
                <BookOpen size={18} /> ÏûêÏÑ∏Ìïú ÏßÑÌñâ Î∞©Ïãù(Curriculum) ÌôïÏù∏ÌïòÍ∏∞
              </span>
              {showCurriculum ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
            </button>

            {showCurriculum && (
              <div className="animate-in slide-in-from-top-2 fade-in duration-300">
                {/* Part 1 */}
                <div className="mb-8 relative border-l-2 border-indigo-200 pl-6 ml-2">
                   <div className="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-indigo-500 border-4 border-white shadow-sm"></div>
                   <h3 className="font-bold text-xl text-indigo-800 mb-1">{meetupInfo.part1Title}</h3>
                   <p className="text-sm text-indigo-400 font-medium mb-4">{meetupInfo.part1Duration}</p>

                   <div className="space-y-6">
                     {/* Item 1 */}
                     <div className="group">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-0.5 rounded">{meetupInfo.p1Time1}</span>
                          <h4 className="font-bold text-slate-700">{meetupInfo.p1Title1}</h4>
                        </div>
                        <p className="text-sm text-slate-600 leading-relaxed pl-1">{meetupInfo.p1Desc1}</p>
                     </div>
                     {/* Item 2 */}
                     <div className="group">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-0.5 rounded">{meetupInfo.p1Time2}</span>
                          <h4 className="font-bold text-slate-700">{meetupInfo.p1Title2}</h4>
                        </div>
                        <p className="text-sm text-slate-600 leading-relaxed pl-1">{meetupInfo.p1Desc2}</p>
                     </div>
                     {/* Item 3 */}
                     <div className="group">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-0.5 rounded">{meetupInfo.p1Time3}</span>
                          <h4 className="font-bold text-slate-700">{meetupInfo.p1Title3}</h4>
                        </div>
                        <p className="text-sm text-slate-600 leading-relaxed pl-1">{meetupInfo.p1Desc3}</p>
                     </div>
                   </div>
                </div>

                {/* Intermission */}
                <div className="mb-8 ml-2">
                    <div className="bg-amber-50 rounded-lg p-4 border border-amber-100 flex items-start gap-3">
                       <div className="bg-amber-100 p-2 rounded-full text-amber-600 shrink-0 mt-0.5">
                          <ArrowRightLeft size={18} />
                       </div>
                       <div>
                          <h4 className="font-bold text-amber-800 text-sm mb-1">{meetupInfo.breakTitle}</h4>
                          <p className="text-xs text-amber-700 leading-relaxed">{meetupInfo.breakDesc}</p>
                       </div>
                    </div>
                </div>

                {/* Part 2 */}
                <div className="relative border-l-2 border-indigo-200 pl-6 ml-2 pb-2">
                   <div className="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-indigo-500 border-4 border-white shadow-sm"></div>
                   <h3 className="font-bold text-xl text-indigo-800 mb-1">{meetupInfo.part2Title}</h3>
                   <p className="text-sm text-indigo-400 font-medium mb-4">{meetupInfo.part2Duration}</p>

                   <div className="space-y-6">
                     {/* Item 1 */}
                     <div className="group">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-0.5 rounded">{meetupInfo.p2Time1}</span>
                          <h4 className="font-bold text-slate-700">{meetupInfo.p2Title1}</h4>
                        </div>
                        <p className="text-sm text-slate-600 leading-relaxed pl-1">{meetupInfo.p2Desc1}</p>
                     </div>
                     {/* Item 2 */}
                     <div className="group">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-0.5 rounded">{meetupInfo.p2Time2}</span>
                          <h4 className="font-bold text-slate-700">{meetupInfo.p2Title2}</h4>
                        </div>
                        <p className="text-sm text-slate-600 leading-relaxed pl-1">{meetupInfo.p2Desc2}</p>
                     </div>
                     {/* Item 3 */}
                     <div className="group">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-0.5 rounded">{meetupInfo.p2Time3}</span>
                          <h4 className="font-bold text-slate-700">{meetupInfo.p2Title3}</h4>
                        </div>
                        <p className="text-sm text-slate-600 leading-relaxed pl-1">{meetupInfo.p2Desc3}</p>
                     </div>
                   </div>
                </div>

                {/* Participation Rules */}
                <div className="mt-8 pt-6 border-t border-slate-100">
                   <h4 className="font-bold text-slate-800 flex items-center gap-2 mb-3">
                      <Lightbulb size={18} className="text-yellow-500 fill-yellow-500" /> {meetupInfo.rulesTitle}
                   </h4>
                   <ul className="space-y-2 text-sm text-slate-600">
                      <li className="flex gap-2 items-start">
                         <span className="text-indigo-500 font-bold mt-0.5">‚Ä¢</span>
                         <span>{meetupInfo.rule1}</span>
                      </li>
                      <li className="flex gap-2 items-start">
                         <span className="text-indigo-500 font-bold mt-0.5">‚Ä¢</span>
                         <span>{meetupInfo.rule2}</span>
                      </li>
                      <li className="flex gap-2 items-start">
                         <span className="text-indigo-500 font-bold mt-0.5">‚Ä¢</span>
                         <span>{meetupInfo.rule3}</span>
                      </li>
                   </ul>
                </div>
              </div>
            )}
          </div>
        </div>

        {/* Application Form */}
        <div className={`bg-white p-6 rounded-xl shadow-md border-l-4 ${isFull ? 'border-orange-500' : 'border-indigo-500'}`}>
          <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
            <Banknote className={isFull ? "text-orange-500" : "text-indigo-500"} />
            {isFull ? 'ÎåÄÍ∏∞ Ïã†Ï≤≠ (Join Waitlist)' : 'Ï∞∏Í∞Ä Ïã†Ï≤≠ (Join Us)'}
          </h2>
          
          <div className={`mb-4 p-4 rounded text-sm space-y-2 ${isFull ? 'bg-orange-50 text-orange-900' : 'bg-indigo-50 text-indigo-900'}`}>
            {isFull ? (
              <>
                <p className="font-bold flex items-center gap-1 text-orange-600 bg-white/50 p-2 rounded mb-2">
                  <Clock size={16} /> ÌòÑÏû¨ Ï†ïÏõêÏù¥ ÎßàÍ∞êÎêòÏóàÏäµÎãàÎã§. ÎåÄÍ∏∞ÏûêÎ°ú Ïã†Ï≤≠Îê©ÎãàÎã§.
                </p>
                <div className="flex items-start gap-2 text-orange-800 mt-2">
                  <AlertCircle size={16} className="shrink-0 mt-0.5" />
                  <p>
                    ÎåÄÍ∏∞ Ïã†Ï≤≠ÏùÄ <strong>Î¨¥Î£å</strong>ÏûÖÎãàÎã§. <br/>
                    Îπà ÏûêÎ¶¨Í∞Ä ÏÉùÍ∏∞Î©¥ Ï∞∏Í∞ÄÎπÑ ÏûÖÍ∏à ÏïàÎÇ¥Î•º ÏúÑÌï¥ Ïó∞ÎùΩÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.
                  </p>
                </div>
                <p className="mt-2 font-bold text-orange-700">
                   ‚Äª Ï∞∏Í∞Ä ÌôïÏ†ï Ïãú ÏòàÏÉÅ Ï∞∏Í∞ÄÎπÑ: {meetupInfo.fee}Ïõê
                </p>
              </>
            ) : (
              <>
                <div className="font-bold text-lg flex flex-wrap items-center gap-2">
                   <span>üí° Ï∞∏Í∞ÄÎπÑ:</span>
                   {meetupInfo.originalFee && <span className="line-through text-slate-400 text-sm">{meetupInfo.originalFee}Ïõê</span>}
                   <span className="text-red-600">{meetupInfo.fee}Ïõê (ÌïúÏãúÏ†Å Ïù¥Î≤§Ìä∏)</span>
                </div>
                <div className="flex flex-col sm:flex-row sm:items-center gap-2 mt-2">
                  <span>{meetupInfo.bankName} {meetupInfo.bankAccount} ({meetupInfo.accountHolder})</span>
                  <button 
                    onClick={handleCopyAccount}
                    className="inline-flex items-center gap-1 bg-white px-2 py-1 rounded border border-slate-200 text-xs font-bold hover:bg-slate-100 active:scale-95 transition-all w-fit"
                  >
                    {copied ? <ClipboardCheck size={14} className="text-green-600"/> : <Copy size={14} />}
                    {copied ? 'Î≥µÏÇ¨Îê®!' : 'Í≥ÑÏ¢å Î≥µÏÇ¨'}
                  </button>
                </div>
                <hr className="border-indigo-100 my-2" />
                <p className="text-slate-600 text-xs flex items-center gap-1 font-medium">
                  {meetupInfo.drinkPolicy}
                </p>
                <p className="text-slate-600 font-medium text-xs flex items-center gap-1">
                  üö´ Î∂àÏ∞∏ Ïãú Ï∞∏Í∞ÄÎπÑÎäî Î∞òÌôòÎêòÏßÄ ÏïäÏäµÎãàÎã§.
                </p>
              </>
            )}
          </div>

          <form onSubmit={handleApply} className="space-y-5">
            {/* Name Input */}
            <div>
              <label className="block text-sm font-bold text-slate-700 mb-1">
                 <div className="flex flex-wrap items-center gap-2">
                    <span className="flex items-center gap-1"><User size={16}/> Ïù¥Î¶Ñ (ÏòàÍ∏àÏ£º)</span>
                    <span className="text-xs text-red-500 font-normal">‚Äª ÏÜ°Í∏à ÌôïÏù∏ ÌõÑ ÏäπÏù∏ÏùÑ ÏúÑÌï¥ Î∞òÎìúÏãú ÏòàÍ∏àÏ£º Î™ÖÏúºÎ°ú ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.</span>
                 </div>
              </label>
              <input 
                type="text" 
                value={name}
                onChange={(e) => setName(e.target.value)}
                placeholder="ex) ÌôçÍ∏∏Îèô"
                className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
              />
            </div>
            
            {/* Contact Input (Only for Waitlist) */}
            {isFull && (
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-1 flex items-center gap-1">
                     <Phone size={16}/> Ïó∞ÎùΩÏ≤ò (Contact)
                  </label>
                  <input 
                    type="tel" 
                    value={contact}
                    onChange={(e) => setContact(e.target.value)}
                    placeholder="010-0000-0000"
                    className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                  />
                  <p className="text-xs text-orange-600 mt-1 font-medium">
                    * Îπà ÏûêÎ¶¨Í∞Ä ÏÉùÍ∏∞Î©¥ Ïù¥ Î≤àÌò∏Î°ú Ïó∞ÎùΩÎìúÎ¶ΩÎãàÎã§.
                  </p>
                </div>
            )}

            {/* Nickname Input */}
            <div>
              <label className="block text-sm font-bold text-slate-700 mb-1 flex items-center gap-1">
                 <Smile size={16}/> ÏòÅÏñ¥ Ïù¥Î¶Ñ (Nick name)
              </label>
              <input 
                type="text" 
                value={nickname}
                onChange={(e) => setNickname(e.target.value)}
                placeholder="ex) Gil"
                className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
              />
              <p className="text-xs text-slate-500 mt-1 flex items-center gap-1">
                <Info size={12}/> Ï∞∏Í∞Ä ÌôïÏ†ï Î™ÖÎã®ÏóêÎäî Ïù¥ ÏòÅÏñ¥ Ïù¥Î¶ÑÏúºÎ°ú ÌëúÏãúÎê©ÎãàÎã§. (ÎØ∏ÏûÖÎ†• Ïãú ÏòàÍ∏àÏ£º Î™ÖÏúºÎ°ú ÌëúÏãú)
              </p>
            </div>

            {/* Gender Selection */}
            <div>
              <label className="block text-sm font-bold text-slate-700 mb-2 flex items-center gap-1">
                <Users size={16}/> ÏÑ±Î≥Ñ (Gender)
              </label>
              <div className="flex gap-3">
                <label className={`flex-1 border rounded-lg p-3 flex items-center justify-center gap-2 cursor-pointer transition-all ${gender === 'male' ? 'bg-indigo-50 border-indigo-500 text-indigo-700 ring-1 ring-indigo-500' : 'hover:bg-slate-50'}`}>
                  <input 
                    type="radio" 
                    name="gender" 
                    value="male" 
                    checked={gender === 'male'} 
                    onChange={(e) => setGender(e.target.value)}
                    className="hidden"
                  />
                  üë® ÎÇ®ÏÑ± (Male)
                </label>
                <label className={`flex-1 border rounded-lg p-3 flex items-center justify-center gap-2 cursor-pointer transition-all ${gender === 'female' ? 'bg-indigo-50 border-indigo-500 text-indigo-700 ring-1 ring-indigo-500' : 'hover:bg-slate-50'}`}>
                  <input 
                    type="radio" 
                    name="gender" 
                    value="female" 
                    checked={gender === 'female'} 
                    onChange={(e) => setGender(e.target.value)}
                    className="hidden"
                  />
                  üë© Ïó¨ÏÑ± (Female)
                </label>
              </div>
            </div>

            {/* English Level Selection */}
            <div>
              <label className="block text-sm font-bold text-slate-700 mb-2 flex items-center gap-1">
                <Activity size={16}/> ÏòÅÏñ¥ ÌöåÌôî Ïã§Î†• (English Proficiency)
              </label>
              <div className="grid gap-2">
                <label className={`border rounded-lg p-3 flex items-center gap-3 cursor-pointer transition-all ${englishLevel === 'low-mid' ? 'bg-slate-50 border-slate-500 text-slate-800 ring-1 ring-slate-500' : 'hover:bg-slate-50'}`}>
                  <input 
                    type="radio" 
                    name="englishLevel" 
                    value="low-mid"
                    checked={englishLevel === 'low-mid'}
                    onChange={(e) => setEnglishLevel(e.target.value)}
                    className="accent-slate-600 w-4 h-4"
                  />
                  <div className="text-sm">
                    <span className="font-bold block">Ï§ëÌïò (Lower Intermediate)</span>
                    <span className="text-xs opacity-80">Î¨∏Ïû• Íµ¨ÏÑ±Ïù¥ ÏÑúÌà¥ÏßÄÎßå ÏùòÏÇ¨ÏÜåÌÜµ Í∞ÄÎä•</span>
                  </div>
                </label>
                <label className={`border rounded-lg p-3 flex items-center gap-3 cursor-pointer transition-all ${englishLevel === 'mid' ? 'bg-emerald-50 border-emerald-500 text-emerald-800 ring-1 ring-emerald-500' : 'hover:bg-slate-50'}`}>
                  <input 
                    type="radio" 
                    name="englishLevel" 
                    value="mid"
                    checked={englishLevel === 'mid'}
                    onChange={(e) => setEnglishLevel(e.target.value)}
                    className="accent-emerald-600 w-4 h-4"
                  />
                  <div className="text-sm">
                    <span className="font-bold block">Ï§ë (Intermediate)</span>
                    <span className="text-xs opacity-80">ÏùºÏÉÅÏ†ÅÏù∏ Ï£ºÏ†úÎ°ú ÎåÄÌôî Í∞ÄÎä• (Daily Conversation)</span>
                  </div>
                </label>
                <label className={`border rounded-lg p-3 flex items-center gap-3 cursor-pointer transition-all ${englishLevel === 'mid-high' ? 'bg-blue-50 border-blue-500 text-blue-800 ring-1 ring-blue-500' : 'hover:bg-slate-50'}`}>
                  <input 
                    type="radio" 
                    name="englishLevel" 
                    value="mid-high"
                    checked={englishLevel === 'mid-high'}
                    onChange={(e) => setEnglishLevel(e.target.value)}
                    className="accent-blue-600 w-4 h-4"
                  />
                  <div className="text-sm">
                    <span className="font-bold block">Ï§ëÏÉÅ (Upper Intermediate)</span>
                    <span className="text-xs opacity-80">Îã§ÏñëÌïú Ï£ºÏ†úÎ°ú ÏùòÍ≤¨ ÌëúÌòÑ Í∞ÄÎä• (Opinion Expression)</span>
                  </div>
                </label>
                <label className={`border rounded-lg p-3 flex items-center gap-3 cursor-pointer transition-all ${englishLevel === 'high' ? 'bg-purple-50 border-purple-500 text-purple-800 ring-1 ring-purple-500' : 'hover:bg-slate-50'}`}>
                  <input 
                    type="radio" 
                    name="englishLevel" 
                    value="high"
                    checked={englishLevel === 'high'}
                    onChange={(e) => setEnglishLevel(e.target.value)}
                    className="accent-purple-600 w-4 h-4"
                  />
                  <div className="text-sm">
                    <span className="font-bold block">ÏÉÅ (Advanced)</span>
                    <span className="text-xs opacity-80">ÎßâÌûòÏóÜÏù¥ ÏûêÏú†Î°úÏö¥ ÌÜ†Î°† Í∞ÄÎä• (Fluent Discussion)</span>
                  </div>
                </label>
              </div>
            </div>

            <p className="text-xs text-slate-500 flex items-center gap-1 justify-start">
                <Info size={12} /> ÏÑ±Î≥ÑÍ≥º ÏòÅÏñ¥ Ïã§Î†•ÏùÄ ÌåÄ ÎπåÎî©(Ï°∞ Ìé∏ÏÑ±) Ïãú ÌôúÏö©ÎêòÎäî Ï†ïÎ≥¥ÏûÖÎãàÎã§.
            </p>

            {/* Checkbox only visible if NOT waitlist */}
            {!isFull && (
              <label className="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-slate-50 transition-colors">
                <input 
                  type="checkbox" 
                  checked={transferred}
                  onChange={(e) => setTransferred(e.target.checked)}
                  className="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 shrink-0"
                />
                <span className="text-slate-700 font-medium">Ï∞∏Í∞ÄÎπÑ ÏÜ°Í∏àÏùÑ ÏôÑÎ£åÌñàÏäµÎãàÎã§.</span>
              </label>
            )}

            {errorMsg && <p className="text-red-500 text-sm font-medium">{errorMsg}</p>}

            <button 
              type="submit" 
              disabled={loading}
              className={`w-full text-white font-bold py-3 rounded-lg transition-all flex items-center justify-center gap-2 shadow-md active:transform active:scale-95 ${isFull ? 'bg-orange-500 hover:bg-orange-600' : 'bg-indigo-600 hover:bg-indigo-700'}`}
            >
              {loading ? 'Ï≤òÎ¶¨Ï§ë...' : (
                <>
                  <Send size={18} />
                  {isFull ? 'ÎåÄÍ∏∞ÏûêÎ°ú Ïã†Ï≤≠ÌïòÍ∏∞ (Join Waitlist)' : 'Ï∞∏Í∞Ä Ïã†Ï≤≠ÌïòÍ∏∞ (Apply)'}
                </>
              )}
            </button>
          </form>
        </div>

        {/* Confirmed List */}
        <div className="space-y-4">
          <div className="flex items-center justify-between flex-wrap gap-2">
            <h2 className="text-xl font-bold flex items-center gap-2">
              <Users className="text-emerald-600" />
              Ï∞∏Í∞ÄÏûê Î™ÖÎã® ({effectiveCount}/{currentMaxCapacity})
            </h2>
            
            {isFull ? (
               <span className="bg-red-100 text-red-700 px-3 py-1 rounded-full font-bold text-sm">
                 ÎßàÍ∞êÎêòÏóàÏäµÎãàÎã§ (Sold Out)
               </span>
            ) : (
               <span className="bg-emerald-100 text-emerald-800 px-3 py-1 rounded-full font-bold text-sm animate-pulse">
                 üî• {Math.max(0, currentMaxCapacity - effectiveCount)}ÏûêÎ¶¨ ÎÇ®ÏïòÏäµÎãàÎã§!
               </span>
            )}
          </div>
          
          <p className="text-xs text-slate-500 mb-3 flex items-center gap-1 bg-slate-100 p-2 rounded border border-slate-200">
             <Info size={14} /> Ï∞∏Í∞Ä ÏäπÏù∏ÏùÄ ÏÑ±Î≥Ñ Î∞è Ïã§Î†•Í≥º Î¨¥Í¥ÄÌïòÍ≤å <b>ÏÑ†Ï∞©Ïàú</b>ÏúºÎ°ú ÏßÑÌñâÎê©ÎãàÎã§.
          </p>

          {attendees.length === 0 ? (
            <div className="text-center py-10 bg-white rounded-xl border border-dashed border-slate-300">
              <p className="text-slate-400">ÏïÑÏßÅ Ïã†Ï≤≠ÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>
            </div>
          ) : (
            <div className="bg-white rounded-xl shadow-sm border border-slate-200 divide-y divide-slate-100">
              {attendees.map(attendee => (
                <div key={attendee.id} className="p-4 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold shrink-0">
                      {attendee.nickname ? attendee.nickname.charAt(0) : attendee.name.charAt(0)}
                    </div>
                    <div>
                      <div className="flex items-center gap-1">
                          <p className="font-bold text-slate-800">
                            {attendee.nickname ? attendee.nickname : attendee.name}
                          </p>
                          {isAdmin && attendee.nickname && (
                              <span className="text-xs text-slate-500 font-normal">({attendee.name})</span>
                          )}
                          {/* ME Highlight */}
                          {user && user.uid === attendee.userId && (
                             <span className="text-[10px] bg-indigo-100 text-indigo-700 font-bold px-1.5 py-0.5 rounded">
                               ME
                             </span>
                          )}
                      </div>
                      
                      {isAdmin ? (
                           <div className="flex flex-col gap-1 mt-0.5">
                              <div className="flex items-center gap-1">
                                <span className="text-[10px] bg-slate-100 text-slate-600 px-1.5 py-0.5 rounded border border-slate-200 flex items-center gap-0.5">
                                    {attendee.gender === 'male' ? 'üë® ÎÇ®' : 'üë© Ïó¨'}
                                </span>
                                <span className={`text-[10px] px-1.5 py-0.5 rounded border ${
                                    attendee.englishLevel === 'low-mid' ? 'bg-slate-50 text-slate-600 border-slate-200' :
                                    attendee.englishLevel === 'mid' ? 'bg-emerald-50 text-emerald-700 border-emerald-100' :
                                    attendee.englishLevel === 'mid-high' ? 'bg-blue-50 text-blue-700 border-blue-100' :
                                    'bg-purple-50 text-purple-700 border-purple-100'
                                }`}>
                                    Lv: {
                                    attendee.englishLevel === 'low-mid' ? 'Ï§ëÌïò' :
                                    attendee.englishLevel === 'mid' ? 'Ï§ë' :
                                    attendee.englishLevel === 'mid-high' ? 'Ï§ëÏÉÅ' : 'ÏÉÅ'
                                    }
                                </span>
                              </div>
                              {attendee.contact && (
                                <p className="text-xs text-slate-500 flex items-center gap-1 font-bold bg-yellow-50 w-fit px-1 rounded">
                                   <Phone size={10} /> {attendee.contact}
                                </p>
                              )}
                           </div>
                      ) : (
                          <p className="text-xs text-slate-500">
                            {attendee.status === 'approved' ? 'Ï∞∏Í∞Ä ÌôïÏ†ïÎê®' : (attendee.isWaitlistApply ? 'ÎåÄÍ∏∞ÏûêÎ°ú Ï†ëÏàòÎê®' : 'ÌôïÏ†ï ÎåÄÍ∏∞Ï§ë (ÏäπÏù∏ ÎåÄÍ∏∞)')}
                          </p>
                      )}
                    </div>
                  </div>
                  <div className="flex items-center gap-2">
                    {attendee.status === 'approved' ? (
                        <span className="flex items-center gap-1 text-emerald-600 text-sm font-bold bg-emerald-50 px-2 py-1 rounded">
                          <CheckCircle size={14} /> Ï∞∏Í∞Ä ÌôïÏ†ï
                        </span>
                    ) : attendee.isWaitlistApply ? (
                        <span className="flex items-center gap-1 text-orange-600 text-sm font-bold bg-orange-50 px-2 py-1 rounded">
                          <Hourglass size={14} /> ÎåÄÍ∏∞Ïûê
                        </span>
                    ) : (
                        <span className="flex items-center gap-1 text-amber-600 text-sm font-bold bg-amber-50 px-2 py-1 rounded">
                          <Clock size={14} /> ÌôïÏ†ï ÎåÄÍ∏∞Ï§ë
                        </span>
                    )}
                    
                    {isAdmin && (
                      <button 
                        onClick={() => handleDeleteClick(attendee.id)}
                        className="text-red-400 hover:text-red-600 p-1 hover:bg-red-50 rounded"
                        title="Í∞ïÌá¥/Ï∑®ÏÜå"
                      >
                        <XCircle size={20} />
                      </button>
                    )}
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>

        {/* Etiquette Section (Card Style) */}
        <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
          <div className="bg-indigo-50 p-4 flex items-center gap-2 border-b border-indigo-100">
            <ThumbsUp size={20} className="text-indigo-600" />
            <h2 className="font-bold text-lg text-indigo-900">{meetupInfo.etiquetteTitle || "Club Etiquette"}</h2>
          </div>
          <div className="divide-y divide-slate-100">
            {[
              { t: meetupInfo.etiquette1Title, d: meetupInfo.etiquette1Desc },
              { t: meetupInfo.etiquette2Title, d: meetupInfo.etiquette2Desc },
              { t: meetupInfo.etiquette3Title, d: meetupInfo.etiquette3Desc }
            ].map((rule, idx) => rule.t && (
              <div key={idx} className="group">
                <button 
                  onClick={() => toggleEtiquette(idx)}
                  className="w-full flex items-center justify-between p-4 text-left hover:bg-slate-50 transition-colors"
                >
                  <span className="font-bold text-slate-700 flex items-center gap-2">
                    <span className="text-indigo-500 font-extrabold text-sm">{idx + 1}.</span> {rule.t}
                  </span>
                  <span className={`text-slate-400 transition-transform duration-200 ${activeEtiquette === idx ? 'rotate-180' : ''}`}>‚ñº</span>
                </button>
                {activeEtiquette === idx && (
                  <div className="p-4 pt-0 pl-9 text-sm text-slate-600 bg-slate-50/50 leading-relaxed animate-in slide-in-from-top-1 border-t border-slate-100">
                    {rule.d}
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>

        {/* FAQ Section (Card Style) */}
        <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
          <div className="bg-indigo-50 p-4 flex items-center gap-2 border-b border-indigo-100">
            <HelpCircle size={20} className="text-indigo-600" />
            <h2 className="font-bold text-lg text-indigo-900">ÏûêÏ£º Î¨ªÎäî ÏßàÎ¨∏ (FAQ)</h2>
          </div>
          <div className="divide-y divide-slate-100">
            {[
              { q: meetupInfo.faq1Q, a: meetupInfo.faq1A },
              { q: meetupInfo.faq2Q, a: meetupInfo.faq2A },
              { q: meetupInfo.faq3Q, a: meetupInfo.faq3A }
            ].map((faq, idx) => faq.q && (
              <div key={idx} className="group">
                <button 
                  onClick={() => toggleFaq(idx)}
                  className="w-full flex items-center justify-between p-4 text-left hover:bg-slate-50 transition-colors"
                >
                  <span className="font-bold text-slate-700 flex items-center gap-2">
                    <span className="text-indigo-500">Q.</span> {faq.q}
                  </span>
                  <span className={`text-slate-400 transition-transform ${activeFaq === idx ? 'rotate-180' : ''}`}>‚ñº</span>
                </button>
                {activeFaq === idx && (
                  <div className="p-4 pt-0 text-sm text-slate-600 bg-slate-50/50 leading-relaxed animate-in slide-in-from-top-1">
                    <span className="font-bold text-emerald-600 mr-1">A.</span> {faq.a}
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>

        {/* Contact & Open Chat */}
        <div className="bg-indigo-50 p-6 rounded-xl border border-indigo-100 text-center">
          <h3 className="font-bold text-indigo-900 mb-2">Í∂ÅÍ∏àÌïú Ï†êÏù¥ Îçî ÏûàÏúºÏã†Í∞ÄÏöî?</h3>
          <p className="text-indigo-700/80 text-sm mb-4">Ïö¥ÏòÅÏßÑÏóêÍ≤å ÏßÅÏ†ë Î¨∏ÏùòÌïòÍ±∞ÎÇò Ïò§ÌîàÏ±ÑÌåÖÎ∞©ÏóêÏÑú ÏÜåÌÜµÌï¥Î≥¥ÏÑ∏Ïöî!</p>
          <a 
            href={meetupInfo.openChatLink || "#"} 
            target="_blank" 
            rel="noreferrer"
            className="inline-flex items-center gap-2 bg-yellow-400 hover:bg-yellow-500 text-black font-bold py-3 px-6 rounded-lg shadow-sm transition-all active:scale-95"
          >
            <MessageSquare size={18} /> Ïπ¥Ïπ¥Ïò§ÌÜ° Ïò§ÌîàÏ±ÑÌåÖÎ∞© Î∞îÎ°úÍ∞ÄÍ∏∞
          </a>
        </div>

        {/* Admin Section (Visible only if logic met) */}
        {isAdmin && (
          <div className="bg-amber-50 p-6 rounded-xl border-2 border-amber-200 mt-8">
            <h3 className="font-bold text-amber-800 mb-4 flex items-center gap-2">
              <Shield size={20} /> Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê: ÎåÄÍ∏∞/Ïã†Ï≤≠ ÎÇ¥Ïó≠ ({attendees.filter(a => a.status === 'pending').length})
            </h3>
            
            {attendees.filter(a => a.status === 'pending').length === 0 ? (
              <p className="text-amber-700/60 text-sm">ÏÉàÎ°úÏö¥ Ïã†Ï≤≠ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>
            ) : (
              <div className="space-y-3">
                {attendees.filter(a => a.status === 'pending').map(attendee => (
                  <div key={attendee.id} className="bg-white p-4 rounded-lg shadow-sm flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div>
                      <div className="flex items-center gap-2 mb-1">
                        <p className="font-bold text-lg">
                           {attendee.nickname ? `${attendee.nickname} (${attendee.name})` : attendee.name}
                        </p>
                        {attendee.isWaitlistApply && (
                          <span className="bg-orange-100 text-orange-700 text-xs px-2 py-0.5 rounded font-bold">ÎåÄÍ∏∞Ïã†Ï≤≠Ïûê</span>
                        )}
                        {!attendee.paid && (
                           <span className="bg-slate-100 text-slate-500 text-xs px-2 py-0.5 rounded">ÎØ∏ÏûÖÍ∏à</span>
                        )}
                      </div>
                      
                      {/* Detailed Info for Admin */}
                      <div className="flex flex-col gap-1 text-sm text-slate-600">
                        <div className="flex items-center gap-1">
                            <span className="text-[10px] bg-slate-100 text-slate-600 px-1.5 py-0.5 rounded border border-slate-200 flex items-center gap-0.5">
                                {attendee.gender === 'male' ? 'üë® ÎÇ®' : 'üë© Ïó¨'}
                            </span>
                            <span className={`text-[10px] px-1.5 py-0.5 rounded border ${
                                attendee.englishLevel === 'low-mid' ? 'bg-slate-50 text-slate-600 border-slate-200' :
                                attendee.englishLevel === 'mid' ? 'bg-emerald-50 text-emerald-700 border-emerald-100' :
                                attendee.englishLevel === 'mid-high' ? 'bg-blue-50 text-blue-700 border-blue-100' :
                                'bg-purple-50 text-purple-700 border-purple-100'
                            }`}>
                                Lv: {
                                attendee.englishLevel === 'low-mid' ? 'Ï§ëÌïò' :
                                attendee.englishLevel === 'mid' ? 'Ï§ë' :
                                attendee.englishLevel === 'mid-high' ? 'Ï§ëÏÉÅ' : 'ÏÉÅ'
                                }
                            </span>
                        </div>
                        {attendee.contact && (
                            <p className="text-xs text-slate-500 flex items-center gap-1 font-bold bg-yellow-50 w-fit px-1 rounded">
                                <Phone size={10} /> {attendee.contact}
                            </p>
                        )}
                      </div>

                      <p className="text-xs text-slate-400 mt-1">
                         Ïã†Ï≤≠ÏãúÍ∞Ñ: {attendee.createdAt ? new Date(attendee.createdAt.seconds * 1000).toLocaleTimeString() : 'Î∞©Í∏à Ï†Ñ'}
                      </p>
                    </div>

                    <div className="flex gap-2 self-end sm:self-center">
                      <button 
                        onClick={() => handleDeleteClick(attendee.id)}
                        className="px-3 py-1.5 bg-red-100 text-red-700 rounded-md text-sm font-medium hover:bg-red-200 transition-colors"
                      >
                        Í±∞Ï†à
                      </button>
                      <button 
                        onClick={() => handleApproveClick(attendee.id)}
                        className={`px-3 py-1.5 text-white rounded-md text-sm font-medium shadow-sm transition-colors ${approvedList.length >= currentMaxCapacity ? 'bg-orange-500 hover:bg-orange-600' : 'bg-indigo-600 hover:bg-indigo-700'}`}
                      >
                        {approvedList.length >= currentMaxCapacity ? 'Ï∂îÍ∞Ä ÏäπÏù∏' : 'ÏäπÏù∏'}
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}
            
             <button 
              onClick={openEditModal}
              className="mt-4 w-full py-2 bg-white border border-amber-300 text-amber-700 font-bold rounded-lg hover:bg-amber-50 flex items-center justify-center gap-2"
            >
              <Settings size={16} /> Ï†ÑÏ≤¥ ÏÑ§Ï†ï Î∞è Ï†ïÎ≥¥ ÏàòÏ†ï
            </button>
          </div>
        )}

      </main>

      {/* Footer */}
      <footer className="max-w-3xl mx-auto mt-12 px-4 pb-8 border-t border-slate-200 pt-8">
        <div className="flex flex-col md:flex-row justify-between items-center gap-4 text-center md:text-left">
          <div>
            <p className="font-bold text-slate-800">{meetupInfo.clubName}</p>
            <p className="text-slate-400 text-sm">Make English Fun Again!</p>
          </div>
          <div className="flex items-center gap-3">
             <button 
              onClick={handleShare}
              className="flex items-center gap-1 text-slate-500 hover:text-indigo-600 transition-colors text-sm font-bold"
            >
              <Share2 size={16} /> ÌéòÏù¥ÏßÄ Í≥µÏú†ÌïòÍ∏∞
            </button>
            <div className="h-4 w-px bg-slate-300"></div>
            {!isAdmin ? (
              <button 
                onClick={toggleAdmin}
                className="text-slate-400 hover:text-slate-600 transition-colors text-sm flex items-center gap-1"
              >
                <Shield size={14} /> Í¥ÄÎ¶¨Ïûê
              </button>
            ) : (
               <button 
                onClick={toggleAdmin}
                className="text-indigo-500 font-bold hover:text-indigo-700 transition-colors text-sm flex items-center gap-1"
              >
                <LogOut size={14} /> ÎÇòÍ∞ÄÍ∏∞
              </button>
            )}
          </div>
        </div>
      </footer>

      {/* Admin Login Modal (Simple) */}
      {showAdminLogin && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-[80] p-4">
          <div className="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm">
            <h3 className="font-bold text-lg mb-4 text-center">Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏ ÏûÖÎ†•</h3>
            <input 
              type="password" 
              value={adminPinInput}
              onChange={(e) => setAdminPinInput(e.target.value)}
              placeholder="PIN ÏûÖÎ†• (1234)"
              className="w-full p-3 border border-slate-300 rounded-lg mb-4 text-center text-lg tracking-widest"
              autoFocus
            />
            <div className="flex gap-2">
              <button 
                onClick={() => setShowAdminLogin(false)}
                className="flex-1 py-2 bg-slate-100 text-slate-600 rounded-lg font-medium"
              >
                Ï∑®ÏÜå
              </button>
              <button 
                onClick={verifyPin}
                className="flex-1 py-2 bg-indigo-600 text-white rounded-lg font-bold"
              >
                ÌôïÏù∏
              </button>
            </div>
            <p className="text-center text-xs text-slate-400 mt-4">Ï¥àÍ∏∞ ÎπÑÎ∞ÄÎ≤àÌò∏: 1234</p>
          </div>
        </div>
      )}
    </div>
  );
}