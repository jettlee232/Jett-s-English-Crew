<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Meetup RSVP</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .animate-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* Hide scrollbar for clean modal */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 pb-20 relative min-h-screen">

    <!-- Root Container -->
    <div id="app"></div>

    <!-- Firebase Logic & App Script -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, setDoc, serverTimestamp, writeBatch } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        // --- Firebase Configuration ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        let app, auth, db;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (e) {
            console.error("Firebase Init Error (Check Config):", e);
        }

        // --- Global State ---
        const state = {
            user: null,
            attendees: [],
            meetupInfo: {
                clubName: "Jett's English Crew",
                meetupTitle: "ì„±ë¶ ì¤‘ìƒê¸‰ ì˜ì–´íšŒí™” & í† ë¡ ",
                meetupDesc: "ì¼ìƒ íšŒí™”ë¥¼ ììœ ë¡­ê²Œ êµ¬ì‚¬í•˜ëŠ” ê²ƒì„ ë„˜ì–´ì„œ ë” ê¹Šì´ ìˆëŠ” ì˜ì–´ í† ë¡ ì„ ì—°ìŠµí•˜ëŠ” ì¤‘ìƒê¸‰ ëª¨ì„ì…ë‹ˆë‹¤.",
                date: "2026ë…„ 2ì›” 1ì¼ (ì¼)",
                time: "ì˜¤ì „ 10:00 - 12:00",
                locationName: "íƒì•¤íƒìŠ¤ ì„±ì‹ ì—¬ëŒ€ì ",
                locationAddress: "ì„œìš¸ ì„±ë¶êµ¬ ë™ì†Œë¬¸ë¡œ22ê¸¸ 31",
                locationLink: "https://map.naver.com/v5/search/íƒì•¤íƒìŠ¤%20ì„±ì‹ ì—¬ëŒ€ì ",
                part1Title: "Part 1. Warm-up & Session 1",
                part1Duration: "50 min",
                p1Time1: "20'", p1Title1: "Small Talk", p1Desc1: "ê°€ë²¼ìš´ ì£¼ì œë¡œ ììœ ë¡­ê²Œ ëŒ€í™” (Ice-breaking)",
                p1Time2: "30'", p1Title2: "Reading & Discussion 1", p1Desc2: "ì‹¬í™” ì§€ë¬¸ ë…í•´ ë° ì‹¬ì¸µ í† ë¡ ",
                p1Time3: "", p1Title3: "", p1Desc3: "",
                breakTitle: "Break (10 min)",
                breakDesc: "Seat Change: íŒŒíŠ¸ë„ˆ êµì²´",
                part2Title: "Part 2. Session 2 & Wrap-up",
                part2Duration: "50 min",
                p2Time1: "10'", p2Title1: "Refresh Talk", p2Desc1: "ìƒˆ íŒŒíŠ¸ë„ˆì™€ ì¸ì‚¬ ë° ê°€ë²¼ìš´ ìŠ¤ëª°í†¡",
                p2Time2: "30'", p2Title2: "Reading & Discussion 2", p2Desc2: "ë‘ ë²ˆì§¸ ì§€ë¬¸ ë…í•´ ë° ì˜ê²¬ êµí™˜",
                p2Time3: "10'", p2Title3: "Closing", p2Desc3: "ì†Œê° ê³µìœ  ë° ë§ˆë¬´ë¦¬",
                topicTitle: "Travel & Adventure",
                session2Topic: "Travel Styles",
                session2Question: "Do you prefer planning every detail of a trip or being spontaneous? What are the pros and cons?",
                maxCapacity: 8,
                fee: "1,000",
                originalFee: "3,000",
                drinkPolicy: "â˜• ê°œì¸ ìŒë£ŒëŠ” ë³„ë„ë¡œ ì£¼ë¬¸í•´ì£¼ì„¸ìš” (1ì¸ 1ë©”ë‰´)",
                bankName: "ì¹´ì¹´ì˜¤ë±…í¬",
                bankAccount: "3333-26-2044919",
                accountHolder: "í™ê¸¸ë™",
                leaderName: "Jett",
                leaderImage: "https://api.dicebear.com/9.x/avataaars/svg?seed=Jett&backgroundColor=c0aede",
                leaderBio: "ë°˜ê°‘ìŠµë‹ˆë‹¤! ë¦¬ë” Jettì…ë‹ˆë‹¤. ğŸ‘‹\nì € ë˜í•œ ì—¬ëŸ¬ë¶„ê³¼ í•¨ê»˜ ì„±ì¥í•´ê°€ëŠ” ì¤‘~ì¤‘ìƒê¸‰ ì˜ì–´ í•™ìŠµìì…ë‹ˆë‹¤.",
                leaderTags: "TESOL ìˆ˜ë£Œ, í˜¸ì£¼ ì›Œí‚¹í™€ë¦¬ë°ì´, ì„¸ê³„ì¼ì£¼",
                etiquetteTitle: "í´ëŸ½ ê·œì¹™",
                etiquette1Title: "ğŸ‘‚ ì„œë¡œë¥¼ ì¡´ì¤‘í•˜ê³  ê²½ì²­í•´ìš”", etiquette1Desc: "íƒ€ì¸ì˜ ë°œì–¸ ì¤‘ì—ëŠ” í•¸ë“œí° ì‚¬ìš©ì„ ìì œí•˜ê³  ê·€ ê¸°ìš¸ì—¬ì£¼ì„¸ìš”.",
                etiquette2Title: "â³ ë°œì–¸ê¶Œì€ ê³µí‰í•˜ê²Œ", etiquette2Desc: "í•œ ì‚¬ëŒì´ ëŒ€í™”ë¥¼ ë…ì í•˜ì§€ ì•Šë„ë¡ ë°°ë ¤í•´ì£¼ì„¸ìš”.",
                etiquette3Title: "ğŸš« ìˆœìˆ˜í•œ í•™ìŠµ ëª¨ì„ì…ë‹ˆë‹¤", etiquette3Desc: "ì¢…êµ í™œë™, ì˜ì—…, ì´ì„± êµì œ ëª©ì ì˜ ì°¸ì—¬ëŠ” ì—„ê²©íˆ ê¸ˆì§€í•©ë‹ˆë‹¤.",
                openChatLink: "#",
                faq1Q: "ì£¼ì°¨ ê°€ëŠ¥í•œê°€ìš”?", faq1A: "íƒì•¤íƒìŠ¤ ê±´ë¬¼ ë‚´ ì£¼ì°¨ëŠ” ì–´ë µìŠµë‹ˆë‹¤.",
                faq2Q: "ì˜ì–´ë¥¼ ì˜ ëª»í•´ë„ ë˜ë‚˜ìš”?", faq2A: "ë¬¼ë¡ ì…ë‹ˆë‹¤! ì¤‘ìƒê¸‰ ì§€í–¥ì´ì§€ë§Œ ì¦ê²ê²Œ ì†Œí†µí•˜ë ¤ëŠ” ë§ˆìŒë§Œ ìˆë‹¤ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.",
                faq3Q: "ì¤€ë¹„ë¬¼ì´ ìˆë‚˜ìš”?", faq3A: "ê°œì¸ í•„ê¸°êµ¬ ì •ë„ë§Œ ì±™ê²¨ì£¼ì„¸ìš”."
            },
            form: {
                name: '', nickname: '', contact: '', password: '', gender: 'female', englishLevel: 'mid', transferred: false, rememberMe: false
            },
            ui: {
                isAdmin: false,
                showAdminLogin: false,
                adminPinInput: '',
                loading: false,
                errorMsg: '',
                toast: null,
                activeFaq: null,
                activeEtiquette: null,
                showCurriculum: false,
                isLeaderExpanded: false,
                modalConfig: null,
                isCancelMode: false,
                showPasswordModal: false,
                cancelPasswordInput: '',
                targetDeleteId: null,
                isEditingInfo: false,
                editForm: {},
                expandedSections: { header: true }
            },
            dDay: ''
        };

        // Make state globally available for UI interactions
        window.state = state;

        const ADMIN_PIN = 'wpxm123';
        const ATTENDEES_COLLECTION = 'english_meetup_attendees';
        const CONFIG_COLLECTION = 'english_meetup_config';
        const CONFIG_DOC_ID = 'meetup_info';

        // --- Helper Functions ---
        window.render = function() {
            const app = document.getElementById('app');
            app.innerHTML = App();
            lucide.createIcons();
            
            const fileInput = document.getElementById('leaderImageInput');
            if(fileInput) {
                fileInput.addEventListener('change', handleImageUpload);
            }
        };

        window.updateState = function(path, value) {
            const keys = path.split('.');
            let obj = state;
            for (let i = 0; i < keys.length - 1; i++) {
                if (!obj[keys[i]]) obj[keys[i]] = {};
                obj = obj[keys[i]];
            }
            obj[keys[keys.length - 1]] = value;
            window.render();
        };

        window.showToast = function(message, type = 'success') {
            window.updateState('ui.toast', { message, type });
            setTimeout(() => window.updateState('ui.toast', null), 3000);
        };

        window.copyToClipboard = function(text, msg) {
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            window.showToast(msg || 'ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        };

        function calculateDDay(dateStr) {
            if (!dateStr) return '';
            try {
                const yearMatch = dateStr.match(/(\d{4})ë…„/);
                const monthMatch = dateStr.match(/(\d{1,2})ì›”/);
                const dayMatch = dateStr.match(/(\d{1,2})ì¼/);
                if (yearMatch && monthMatch && dayMatch) {
                    const target = new Date(yearMatch[1], monthMatch[1] - 1, dayMatch[1]);
                    const today = new Date();
                    target.setHours(0,0,0,0); today.setHours(0,0,0,0);
                    const diff = Math.ceil((target - today) / (1000 * 60 * 60 * 24));
                    if (diff === 0) return "D-Day";
                    if (diff > 0) return `D-${diff}`;
                    return "End";
                }
            } catch (e) { return ''; }
            return '';
        }

        // --- Business Logic ---
        window.handleLogin = () => {
            if (state.ui.adminPinInput === ADMIN_PIN) {
                state.ui.isAdmin = true;
                state.ui.showAdminLogin = false;
                state.ui.adminPinInput = '';
                window.showToast('ê´€ë¦¬ìë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.');
            } else {
                window.showToast('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.', 'error');
            }
            window.render();
        };

        window.handleApply = async (e) => {
            e.preventDefault();
            const { name, contact, password, transferred } = state.form;
            const currentCount = state.attendees.filter(a => a.status === 'approved' || (a.status === 'pending' && a.paid)).length;
            const maxCap = parseInt(state.meetupInfo.maxCapacity);
            const isWaitlist = currentCount >= maxCap;

            if (!name.trim()) return window.updateState('ui.errorMsg', 'ì´ë¦„(ì˜ˆê¸ˆì£¼)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            if (!isWaitlist && !transferred) return window.updateState('ui.errorMsg', 'ì°¸ê°€ë¹„ë¥¼ ì†¡ê¸ˆí•œ í›„ ì²´í¬í•´ì£¼ì„¸ìš”.');
            if (isWaitlist && !contact.trim()) return window.updateState('ui.errorMsg', 'ëŒ€ê¸° ì‹ ì²­ ì‹œ ì—°ë½ì²˜ ì…ë ¥ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
            if (!password || password.length < 4) return window.updateState('ui.errorMsg', 'ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');

            window.updateState('ui.loading', true);
            try {
                if(!state.user) throw new Error("User not authenticated");
                
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', ATTENDEES_COLLECTION), {
                    ...state.form,
                    status: 'pending',
                    isWaitlistApply: isWaitlist,
                    paid: !isWaitlist,
                    createdAt: serverTimestamp(),
                    userId: state.user.uid
                });

                if (state.form.rememberMe) {
                    localStorage.setItem('meetup_user_info', JSON.stringify(state.form));
                } else {
                    localStorage.removeItem('meetup_user_info');
                }

                state.form = { name: '', nickname: '', contact: '', password: '', gender: 'female', englishLevel: 'mid', transferred: false, rememberMe: state.form.rememberMe };
                state.ui.errorMsg = '';
                window.showToast(isWaitlist ? 'ëŒ€ê¸°ìë¡œ ì‹ ì²­ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (err) {
                console.error(err);
                window.showToast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
            state.ui.loading = false;
            window.render();
        };

        window.executeApprove = async (id) => {
            if(!state.user) return;
            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', ATTENDEES_COLLECTION, id), { status: 'approved', paid: true });
            state.ui.modalConfig = null;
            window.showToast('ìŠ¹ì¸ ì™„ë£Œ');
            window.render();
        };

        window.handleApproveClick = (id) => {
            const count = state.attendees.filter(a => a.status === 'approved').length;
            const max = parseInt(state.meetupInfo.maxCapacity);
            if (count >= max) {
                state.ui.modalConfig = {
                    title: 'ì •ì› ì´ˆê³¼ ìŠ¹ì¸', message: `í˜„ì¬ ì •ì›(${max}ëª…)ì´ ì°¼ìŠµë‹ˆë‹¤. ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`,
                    confirmText: 'ì¶”ê°€ ìŠ¹ì¸', isDestructive: false,
                    onConfirm: `executeApprove('${id}')`
                };
                window.render();
            } else {
                window.executeApprove(id);
            }
        };

        window.executeDelete = async (id) => {
            if(!state.user) return;
            await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', ATTENDEES_COLLECTION, id));
            state.ui.modalConfig = null;
            state.ui.showPasswordModal = false;
            state.ui.isCancelMode = false;
            window.showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.render();
        };

        window.handleDeleteRequest = (id) => {
            if (state.ui.isAdmin) {
                state.ui.modalConfig = {
                    title: 'ì‚­ì œ í™•ì¸', message: 'ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
                    confirmText: 'ì‚­ì œí•˜ê¸°', isDestructive: true,
                    onConfirm: `executeDelete('${id}')`
                };
                window.render();
            } else {
                state.ui.targetDeleteId = id;
                state.ui.cancelPasswordInput = '';
                state.ui.showPasswordModal = true;
                window.render();
            }
        };

        window.verifyCancelPassword = () => {
            const target = state.attendees.find(a => a.id === state.ui.targetDeleteId);
            if (target && target.password === state.ui.cancelPasswordInput) {
                window.executeDelete(state.ui.targetDeleteId);
            } else {
                window.showToast('ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜', 'error');
                state.ui.cancelPasswordInput = '';
                window.render();
            }
        };

        window.executeResetAttendees = async () => {
             if(!state.user) return;
             const batch = writeBatch(db);
             state.attendees.forEach(att => {
                 const ref = doc(db, 'artifacts', appId, 'public', 'data', ATTENDEES_COLLECTION, att.id);
                 batch.delete(ref);
             });
             await batch.commit();
             state.ui.modalConfig = null;
             window.showToast('ëª…ë‹¨ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
             window.render();
        };

        window.handleResetClick = () => {
            state.ui.modalConfig = {
                title: 'ëª…ë‹¨ ì´ˆê¸°í™”', message: 'ëª¨ë“  ì°¸ê°€ì ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë³µêµ¬ ë¶ˆê°€)',
                confirmText: 'ì´ˆê¸°í™”', isDestructive: true,
                onConfirm: 'executeResetAttendees()'
            };
            window.render();
        };

        window.downloadCSV = () => {
             if (state.attendees.length === 0) return window.showToast('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
             const BOM = '\uFEFF';
             const headers = ['ì´ë¦„','ë‹‰ë„¤ì„','ì—°ë½ì²˜','ì„±ë³„','ë ˆë²¨','ìƒíƒœ','ì…ê¸ˆ','ì‹ ì²­ì‹œê°„'];
             const rows = state.attendees.map(a => [
                 a.name, a.nickname, a.contact, a.gender, a.englishLevel, a.status, a.paid?'O':'X', 
                 a.createdAt ? new Date(a.createdAt.seconds*1000).toLocaleString() : ''
             ].map(v => `"${String(v||'').replace(/"/g, '""')}"`).join(','));
             
             const blob = new Blob([BOM + headers.join(',') + '\n' + rows.join('\n')], {type: 'text/csv;charset=utf-8;'});
             const url = URL.createObjectURL(blob);
             const link = document.createElement('a');
             link.href = url;
             link.download = `meetup_${new Date().toISOString().slice(0,10)}.csv`;
             link.click();
        };

        window.handleImageUpload = (e) => {
             const file = e.target.files[0];
             if(!file) return;
             if(file.size > 500*1024) return window.showToast('500KB ì´í•˜ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
             const reader = new FileReader();
             reader.onloadend = () => {
                 state.ui.editForm.leaderImage = reader.result;
                 window.render();
             };
             reader.readAsDataURL(file);
        };

        window.saveInfo = async () => {
            if(!state.user) return;
            await setDoc(doc(db, 'artifacts', appId, 'public', 'data', CONFIG_COLLECTION, CONFIG_DOC_ID), state.ui.editForm);
            state.ui.isEditingInfo = false;
            window.showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.render();
        };

        window.handleContactChange = (e) => {
            let val = e.target.value.replace(/[^0-9]/g, '');
            if(val.length > 11) val = val.slice(0,11);
            state.form.contact = val;
            window.render();
            const input = document.querySelector('input[name="contact"]');
            if (input) input.focus();
        };

        // --- Component Renderers ---
        const Icons = {
            Calendar: `<i data-lucide="calendar" class="w-6 h-6"></i>`,
            MapPin: `<i data-lucide="map-pin" class="w-6 h-6"></i>`,
            Award: `<i data-lucide="award" class="w-5 h-5"></i>`,
            Settings: `<i data-lucide="settings" class="w-5 h-5"></i>`,
            Copy: `<i data-lucide="copy" class="w-3 h-3"></i>`,
            Check: `<i data-lucide="check-circle" class="w-4 h-4"></i>`,
            User: `<i data-lucide="user" class="w-4 h-4"></i>`,
            Smile: `<i data-lucide="smile" class="w-4 h-4"></i>`,
            Phone: `<i data-lucide="phone" class="w-4 h-4"></i>`,
            Lock: `<i data-lucide="lock" class="w-4 h-4"></i>`,
            Send: `<i data-lucide="send" class="w-4 h-4"></i>`,
            Down: `<i data-lucide="chevron-down" class="w-4 h-4"></i>`,
            Up: `<i data-lucide="chevron-up" class="w-4 h-4"></i>`
        };

        function App() {
            const { meetupInfo, ui, dDay, attendees } = state;
            const currentCount = attendees.filter(a => a.status === 'approved' || (a.status === 'pending' && a.paid)).length;
            const maxCap = parseInt(meetupInfo.maxCapacity);
            const isFull = currentCount >= maxCap;

            return `
                ${ui.toast ? `
                    <div class="fixed top-4 left-1/2 transform -translate-x-1/2 z-[100] animate-in w-full max-w-sm px-4">
                        <div class="shadow-lg rounded-lg p-4 flex items-center gap-3 text-white font-medium ${ui.toast.type === 'error' ? 'bg-red-500' : 'bg-indigo-500'}">
                            ${ui.toast.message}
                        </div>
                    </div>
                ` : ''}

                <header class="bg-indigo-600 text-white p-6 shadow-lg">
                    <div class="max-w-3xl mx-auto flex justify-between items-start">
                        <div>
                            <h1 class="text-3xl font-bold mb-2">${meetupInfo.clubName}</h1>
                            <p class="opacity-90 font-medium text-lg mb-2 flex items-center gap-2">
                                ${dDay ? `<span class="text-xs font-extrabold px-2 py-1 rounded shadow-sm ${dDay==='End'?'bg-slate-200 text-slate-500':'bg-white text-red-600'}">${dDay}</span>` : ''}
                                ${meetupInfo.meetupTitle}
                            </p>
                            <p class="text-indigo-100 text-sm leading-relaxed max-w-xl">${meetupInfo.meetupDesc}</p>
                        </div>
                        ${ui.isAdmin ? `<button onclick="state.ui.editForm = {...state.meetupInfo}; state.ui.isEditingInfo = true; window.render()" class="bg-white/10 p-2 rounded-lg">${Icons.Settings}</button>` : ''}
                    </div>
                </header>

                <main class="max-w-3xl mx-auto p-4 space-y-6 -mt-6">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 flex items-start gap-4">
                            <div class="bg-indigo-100 p-3 rounded-full text-indigo-600 shrink-0">${Icons.Calendar}</div>
                            <div>
                                <h3 class="font-semibold text-slate-500 text-sm uppercase">Date & Time</h3>
                                <p class="font-bold text-lg">${meetupInfo.date}</p>
                                <p class="text-indigo-600 font-medium">${meetupInfo.time}</p>
                            </div>
                        </div>
                        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 flex items-start gap-4">
                            <div class="bg-emerald-100 p-3 rounded-full text-emerald-600 shrink-0">${Icons.MapPin}</div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-slate-500 text-sm uppercase">Location</h3>
                                <p class="font-bold text-lg">${meetupInfo.locationName}</p>
                                <p class="text-slate-500 text-sm mb-2">${meetupInfo.locationAddress}</p>
                                <a href="${meetupInfo.locationLink}" target="_blank" class="inline-flex items-center gap-1 text-xs font-bold bg-emerald-50 text-emerald-600 px-2 py-1 rounded hover:bg-emerald-100">
                                    ë„¤ì´ë²„ ì§€ë„ ë³´ê¸°
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                        <div class="bg-gradient-to-r from-indigo-50 to-white p-4 flex items-center gap-2 border-b border-indigo-50">
                            <div class="text-indigo-600">${Icons.Award}</div>
                            <h2 class="font-bold text-lg text-indigo-900">Meet Your Host</h2>
                        </div>
                        <div class="p-6">
                            <div class="flex flex-col md:flex-row gap-6 items-start">
                                <div class="shrink-0 flex flex-col items-center justify-center w-full md:w-48 bg-slate-50 rounded-xl p-4 border border-slate-100">
                                    <div class="w-24 h-24 md:w-full md:h-auto md:aspect-square rounded-full md:rounded-xl overflow-hidden border-4 border-white shadow-md mb-3">
                                        <img src="${meetupInfo.leaderImage}" class="w-full h-full object-cover">
                                    </div>
                                    <div class="text-center w-full">
                                        <p class="font-bold text-xl text-slate-800">${meetupInfo.leaderName}</p>
                                        <p class="text-xs text-indigo-600 font-bold bg-indigo-100 px-2 py-0.5 rounded-full inline-block mt-1 mb-3">English Meetup Leader</p>
                                        <button onclick="state.ui.isLeaderExpanded = !state.ui.isLeaderExpanded; window.render()" class="md:hidden w-full py-2 flex items-center justify-center gap-1 text-sm font-bold text-slate-500 bg-white border border-slate-200 rounded-lg">
                                            ${state.ui.isLeaderExpanded ? 'ì ‘ê¸°' : 'ì†Œê°œ ë³´ê¸°'} ${state.ui.isLeaderExpanded ? Icons.Up : Icons.Down}
                                        </button>
                                    </div>
                                </div>
                                <div class="flex-1 flex flex-col justify-center space-y-5 ${state.ui.isLeaderExpanded ? 'block' : 'hidden'} md:flex">
                                    <div class="text-sm text-slate-600 leading-relaxed whitespace-pre-wrap">${meetupInfo.leaderBio}</div>
                                    <div class="flex flex-wrap gap-2">
                                        ${meetupInfo.leaderTags.split(',').map(tag => `<span class="bg-white text-slate-700 text-xs px-3 py-1.5 rounded-lg font-medium border border-slate-200 shadow-sm">${tag.trim()}</span>`).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                        <div class="bg-indigo-50 p-4 flex items-center gap-2 border-b border-indigo-100">
                            <i data-lucide="message-circle" class="text-indigo-600 w-5 h-5"></i>
                            <h2 class="font-bold text-lg text-indigo-900">This Week's Topic</h2>
                            <button onclick="copyToClipboard('[${meetupInfo.topicTitle}] ${meetupInfo.session2Topic} - ${meetupInfo.session2Question}', 'í† í”½ ë³µì‚¬ ì™„ë£Œ')" class="ml-auto text-xs bg-white text-indigo-600 border border-indigo-200 px-2 py-1 rounded flex items-center gap-1">
                                ${Icons.Copy} í† í”½ ë³µì‚¬
                            </button>
                        </div>
                        <div class="p-5">
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 mb-8">
                                <h4 class="font-bold text-indigo-600 text-sm mb-2">Today's Debate Topic</h4>
                                <p class="text-slate-700 text-sm italic whitespace-pre-wrap">"${meetupInfo.session2Question}"</p>
                            </div>
                            <button onclick="state.ui.showCurriculum = !state.ui.showCurriculum; window.render()" class="w-full flex items-center justify-between p-3 bg-indigo-50 text-indigo-700 font-bold rounded-lg border border-indigo-100 mb-4">
                                <span class="flex items-center gap-2"><i data-lucide="book-open" class="w-4 h-4"></i> ìì„¸í•œ ì§„í–‰ ë°©ì‹ í™•ì¸í•˜ê¸°</span>
                                ${state.ui.showCurriculum ? Icons.Up : Icons.Down}
                            </button>
                            ${state.ui.showCurriculum ? `
                                <div class="animate-in space-y-6">
                                    <div class="relative pl-4 border-l-2 border-indigo-200">
                                        <h3 class="font-bold text-lg text-indigo-800">${meetupInfo.part1Title}</h3>
                                        <p class="text-sm text-indigo-400 mb-2">${meetupInfo.part1Duration}</p>
                                        <div class="space-y-2 text-sm text-slate-600">
                                            ${[1,2,3].map(i => meetupInfo[`p1Title${i}`] ? `<div class="flex gap-2"><span class="bg-indigo-100 text-indigo-700 text-xs px-2 py-0.5 rounded font-bold h-fit">${meetupInfo[`p1Time${i}`]}</span><div><p class="font-bold">${meetupInfo[`p1Title${i}`]}</p><p>${meetupInfo[`p1Desc${i}`]}</p></div></div>` : '').join('')}
                                        </div>
                                    </div>
                                    <div class="bg-amber-50 p-4 rounded-lg border border-amber-100">
                                        <h4 class="font-bold text-amber-800 text-sm">${meetupInfo.breakTitle}</h4>
                                        <p class="text-xs text-amber-700">${meetupInfo.breakDesc}</p>
                                    </div>
                                    <div class="relative pl-4 border-l-2 border-indigo-200">
                                        <h3 class="font-bold text-lg text-indigo-800">${meetupInfo.part2Title}</h3>
                                        <p class="text-sm text-indigo-400 mb-2">${meetupInfo.part2Duration}</p>
                                        <div class="space-y-2 text-sm text-slate-600">
                                            ${[1,2,3].map(i => meetupInfo[`p2Title${i}`] ? `<div class="flex gap-2"><span class="bg-indigo-100 text-indigo-700 text-xs px-2 py-0.5 rounded font-bold h-fit">${meetupInfo[`p2Time${i}`]}</span><div><p class="font-bold">${meetupInfo[`p2Title${i}`]}</p><p>${meetupInfo[`p2Desc${i}`]}</p></div></div>` : '').join('')}
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-md border-l-4 ${isFull ? 'border-orange-500' : 'border-indigo-500'}">
                        <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                            <i data-lucide="banknote" class="${isFull ? 'text-orange-500' : 'text-indigo-500'}"></i>
                            ${isFull ? 'ëŒ€ê¸° ì‹ ì²­ (Join Waitlist)' : 'ì°¸ê°€ ì‹ ì²­ (Join Us)'}
                        </h2>
                        
                        <div class="mb-4 p-4 rounded text-sm space-y-2 ${isFull ? 'bg-orange-50 text-orange-900' : 'bg-indigo-50 text-indigo-900'}">
                             ${isFull ? `
                                <p class="font-bold">í˜„ì¬ ì •ì›ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€ê¸°ìë¡œ ì‹ ì²­ë©ë‹ˆë‹¤.</p>
                                <p>ëŒ€ê¸° ì‹ ì²­ì€ ë¬´ë£Œì´ë©°, ë¹ˆ ìë¦¬ê°€ ìƒê¸°ë©´ ì—°ë½ë“œë¦½ë‹ˆë‹¤.</p>
                             ` : `
                                <div class="font-bold text-lg flex flex-wrap items-center gap-2">
                                    <span>ì°¸ê°€ë¹„:</span>
                                    ${meetupInfo.originalFee ? `<span class="line-through text-slate-400 text-sm">${meetupInfo.originalFee}ì›</span>` : ''}
                                    <span class="text-red-600">${meetupInfo.fee}ì›</span>
                                </div>
                                <div class="flex flex-col sm:flex-row sm:items-center gap-2">
                                    <span>${meetupInfo.bankName} ${meetupInfo.bankAccount} (${meetupInfo.accountHolder})</span>
                                    <button onclick="copyToClipboard('${meetupInfo.bankAccount}', 'ê³„ì¢Œ ë³µì‚¬ ì™„ë£Œ')" class="bg-white px-2 py-1 rounded border text-xs font-bold hover:bg-slate-100">ê³„ì¢Œ ë³µì‚¬</button>
                                </div>
                                <hr class="border-indigo-100 my-2" />
                                <p class="text-xs text-slate-600">${meetupInfo.drinkPolicy}</p>
                                <p class="text-xs text-slate-600 font-medium">ğŸš« ë¶ˆì°¸ ì‹œ ì°¸ê°€ë¹„ëŠ” ë°˜í™˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                             `}
                        </div>

                        <form onsubmit="handleApply(event)" class="space-y-6">
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-1.5 flex items-center gap-1.5">${Icons.User} ì´ë¦„ (ì˜ˆê¸ˆì£¼)</label>
                                <input type="text" value="${state.form.name}" oninput="state.form.name = this.value" placeholder="ex) í™ê¸¸ë™" class="w-full p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500">
                                <p class="text-xs text-slate-500 mt-1.5 flex items-start gap-1" style="word-break: keep-all">
                                    <i data-lucide="alert-circle" class="w-3 h-3 mt-0.5 text-indigo-500"></i> ì†¡ê¸ˆ í™•ì¸ í›„ ìŠ¹ì¸ì„ ìœ„í•´ ë°˜ë“œì‹œ <b>ì˜ˆê¸ˆì£¼ ëª…</b>ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.
                                </p>
                            </div>
                             ${isFull ? `
                                <div>
                                    <label class="block text-sm font-bold text-slate-700 mb-1.5 flex items-center gap-1.5">${Icons.Phone} ì—°ë½ì²˜</label>
                                    <input type="tel" name="contact" value="${state.form.contact}" oninput="handleContactChange(event)" placeholder="010-0000-0000" class="w-full p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500">
                                </div>
                            ` : ''}
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-1.5 flex items-center gap-1.5">${Icons.Smile} ì˜ì–´ ì´ë¦„ (Nickname)</label>
                                <input type="text" value="${state.form.nickname}" oninput="state.form.nickname = this.value" placeholder="ex) Gil" class="w-full p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500">
                                <p class="text-xs text-slate-500 mt-1.5 flex items-start gap-1" style="word-break: keep-all">
                                    <i data-lucide="info" class="w-3 h-3 mt-0.5"></i> ì°¸ê°€ í™•ì • ëª…ë‹¨ì—ëŠ” ì´ ì˜ì–´ ì´ë¦„ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
                                </p>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-2 flex items-center gap-1.5"><i data-lucide="users" class="w-4 h-4 text-indigo-600"></i> ì„±ë³„</label>
                                <div class="flex gap-3">
                                    <label class="flex-1 border rounded-lg p-3 flex justify-center gap-2 cursor-pointer ${state.form.gender==='male'?'bg-indigo-50 border-indigo-500 text-indigo-700':''}">
                                        <input type="radio" name="gender" value="male" class="hidden" onclick="state.form.gender='male'; window.render()" ${state.form.gender==='male'?'checked':''}> ğŸ‘¨ ë‚¨ì„±
                                    </label>
                                    <label class="flex-1 border rounded-lg p-3 flex justify-center gap-2 cursor-pointer ${state.form.gender==='female'?'bg-indigo-50 border-indigo-500 text-indigo-700':''}">
                                        <input type="radio" name="gender" value="female" class="hidden" onclick="state.form.gender='female'; window.render()" ${state.form.gender==='female'?'checked':''}> ğŸ‘© ì—¬ì„±
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-2 flex items-center gap-1.5"><i data-lucide="activity" class="w-4 h-4 text-indigo-600"></i> ì˜ì–´ ì‹¤ë ¥</label>
                                <div class="grid gap-2">
                                    ${['low-mid|ì¤‘í•˜|ë¬¸ì¥ êµ¬ì„±ì´ ì„œíˆ´ì§€ë§Œ ì†Œí†µ ê°€ëŠ¥', 'mid|ì¤‘|ì¼ìƒì ì¸ ì£¼ì œë¡œ ëŒ€í™” ê°€ëŠ¥', 'mid-high|ì¤‘ìƒ|ë‹¤ì–‘í•œ ì£¼ì œë¡œ ì˜ê²¬ í‘œí˜„', 'high|ìƒ|ììœ ë¡œìš´ í† ë¡  ê°€ëŠ¥'].map(opt => {
                                        const [val, label, desc] = opt.split('|');
                                        const isSel = state.form.englishLevel === val;
                                        return `<label class="border rounded-lg p-3 flex items-center gap-3 cursor-pointer ${isSel?'bg-emerald-50 border-emerald-500 text-emerald-800':''}"><input type="radio" name="level" value="${val}" class="w-4 h-4" onclick="state.form.englishLevel='${val}'; window.render()" ${isSel?'checked':''}><div><span class="font-bold block">${label}</span><span class="text-xs opacity-80">${desc}</span></div></label>`;
                                    }).join('')}
                                </div>
                                <p class="text-xs text-slate-500 mt-2 flex items-start gap-1" style="word-break: keep-all"><i data-lucide="info" class="w-3 h-3 mt-0.5"></i> ì„±ë³„ê³¼ ì˜ì–´ ì‹¤ë ¥ì€ íŒ€ ë¹Œë”©(ì¡° í¸ì„±) ì‹œ í™œìš©ë©ë‹ˆë‹¤.</p>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-1.5 flex items-center gap-1.5">${Icons.Lock} ë¹„ë°€ë²ˆí˜¸ (4ìë¦¬ ìˆ«ì)</label>
                                <div class="flex gap-3">
                                    ${[0,1,2,3].map(i => `<div class="w-12 h-12 border-2 rounded-lg flex items-center justify-center text-xl font-bold ${state.form.password.length===i ? 'border-indigo-500 bg-indigo-50 text-indigo-700' : 'bg-white'}">${state.form.password[i] || ''}</div>`).join('')}
                                </div>
                                <input type="tel" maxlength="4" value="${state.form.password}" oninput="this.value=this.value.replace(/[^0-9]/g,''); state.form.password=this.value; window.render()" class="mt-2 w-full p-2 border rounded" placeholder="ìˆ«ì ì…ë ¥">
                                <p class="text-xs text-slate-500 mt-1 text-center">ì‹ ì²­ ì·¨ì†Œ ì‹œ ë³¸ì¸ í™•ì¸ìš©</p>
                            </div>
                            
                            <div class="flex flex-col gap-1">
                                ${!isFull ? `
                                <label class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-slate-50">
                                    <input type="checkbox" ${state.form.transferred ? 'checked' : ''} onclick="state.form.transferred=this.checked; window.render()" class="w-5 h-5 text-indigo-600 rounded">
                                    <span class="text-slate-700 font-medium">ì°¸ê°€ë¹„ ì†¡ê¸ˆì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.</span>
                                </label>` : ''}
                                <label class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-slate-50">
                                    <input type="checkbox" ${state.form.rememberMe ? 'checked' : ''} onclick="state.form.rememberMe=this.checked; window.render()" class="w-5 h-5 text-indigo-600 rounded">
                                    <span class="text-slate-700 font-medium">ë‹¤ìŒ ë°©ë¬¸ ì‹œ ìë™ ì…ë ¥í•©ë‹ˆë‹¤. (ì„ íƒ)</span>
                                </label>
                            </div>

                            ${state.ui.errorMsg ? `<p class="text-red-500 text-sm font-bold text-center animate-pulse">${state.ui.errorMsg}</p>` : ''}
                            
                            <button type="submit" class="w-full text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2 shadow-md ${isFull ? 'bg-orange-500 hover:bg-orange-600' : 'bg-indigo-600 hover:bg-indigo-700'}">
                                ${state.ui.loading ? 'ì²˜ë¦¬ì¤‘...' : (isFull ? 'ëŒ€ê¸°ìë¡œ ì‹ ì²­í•˜ê¸°' : 'ì°¸ê°€ ì‹ ì²­í•˜ê¸°')}
                            </button>
                        </form>
                    </div>

                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <h2 class="text-xl font-bold flex gap-2 items-center"><i data-lucide="users" class="text-emerald-600"></i> ì°¸ê°€ì ëª…ë‹¨ (${currentCount}/${maxCap})</h2>
                            <button onclick="state.ui.isCancelMode = !state.ui.isCancelMode; window.render()" class="text-xs px-2 py-1 rounded font-bold border ${state.ui.isCancelMode ? 'bg-slate-800 text-white' : 'bg-white'}">
                                ${state.ui.isCancelMode ? 'ì·¨ì†Œ ëª¨ë“œ ë„ê¸°' : 'ë‚´ ì‹ ì²­ ì·¨ì†Œí•˜ê¸°'}
                            </button>
                        </div>
                        <p class="text-xs text-slate-500 bg-slate-100 p-2 rounded border" style="word-break: keep-all">
                            <i data-lucide="info" class="w-3 h-3 inline"></i> ì°¸ê°€ ìŠ¹ì¸ì€ ì„±ë³„ ë° ì‹¤ë ¥ê³¼ ë¬´ê´€í•˜ê²Œ ì„ ì°©ìˆœìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.
                        </p>
                        
                        <div class="bg-white rounded-xl shadow-sm border border-slate-200 divide-y divide-slate-100">
                            ${attendees.length === 0 ? '<div class="p-10 text-center text-slate-400">ì•„ì§ ì‹ ì²­ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>' : attendees.map(att => `
                                <div class="p-4 flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold">${(att.nickname || att.name).charAt(0)}</div>
                                        <div>
                                            <p class="font-bold text-slate-800 flex items-center gap-1">
                                                ${att.nickname || att.name}
                                                ${state.user?.uid === att.userId ? '<span class="text-[10px] bg-indigo-100 text-indigo-700 px-1 rounded">ME</span>' : ''}
                                                ${state.ui.isAdmin ? `<span class="text-xs font-normal text-slate-500">(${att.name})</span>` : ''}
                                            </p>
                                            <p class="text-xs text-slate-500">
                                                ${state.ui.isAdmin ? `${att.gender==='male'?'ë‚¨':'ì—¬'} | ${att.englishLevel} | ${att.contact || ''}` : 
                                                  att.status === 'approved' ? '<span class="text-emerald-600 font-bold">í™•ì •</span>' : 
                                                  att.isWaitlistApply ? '<span class="text-orange-600 font-bold">ëŒ€ê¸°</span>' : '<span class="text-amber-600">ìŠ¹ì¸ ëŒ€ê¸°ì¤‘</span>'}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="flex gap-1">
                                        ${(state.ui.isAdmin || state.ui.isCancelMode) ? 
                                            `<button onclick="handleDeleteRequest('${att.id}')" class="text-red-500 p-1"><i data-lucide="trash-2" class="w-5 h-5"></i></button>` : ''}
                                        ${state.ui.isAdmin && att.status !== 'approved' ? 
                                            `<button onclick="handleApproveClick('${att.id}')" class="text-emerald-500 p-1"><i data-lucide="check-circle" class="w-5 h-5"></i></button>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        ${state.ui.isAdmin ? `
                            <div class="flex flex-col gap-2 mt-4">
                                <button onclick="state.ui.editForm = {...state.meetupInfo}; state.ui.isEditingInfo = true; window.render()" class="w-full py-2 bg-white border border-amber-300 text-amber-700 font-bold rounded-lg flex items-center justify-center gap-2">
                                    ${Icons.Settings} ì „ì²´ ì„¤ì • ë° ì •ë³´ ìˆ˜ì •
                                </button>
                                <button onclick="downloadCSV()" class="w-full py-2 bg-emerald-50 border border-emerald-200 text-emerald-700 font-bold rounded-lg flex items-center justify-center gap-2">
                                    <i data-lucide="download" class="w-4 h-4"></i> ì—‘ì…€(CSV)ë¡œ ëª…ë‹¨ ì €ì¥
                                </button>
                                <button onclick="handleResetClick()" class="w-full py-2 bg-red-50 border border-red-200 text-red-600 font-bold rounded-lg flex items-center justify-center gap-2">
                                    <i data-lucide="refresh-cw" class="w-4 h-4"></i> ì°¸ê°€ì ëª…ë‹¨ ì´ˆê¸°í™”
                                </button>
                            </div>
                        ` : ''}
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                        <div class="bg-indigo-50 p-4 border-b border-indigo-100 flex items-center gap-2 font-bold text-lg text-indigo-900">
                            <i data-lucide="help-circle" class="w-5 h-5"></i> FAQ
                        </div>
                        <div class="divide-y">
                            ${[1,2,3].map(i => meetupInfo[`faq${i}Q`] ? `
                                <div>
                                    <button onclick="state.ui.activeFaq = state.ui.activeFaq === ${i} ? null : ${i}; window.render()" class="w-full p-4 text-left flex justify-between font-bold text-slate-700 hover:bg-slate-50">
                                        <span><span class="text-indigo-500">Q.</span> ${meetupInfo[`faq${i}Q`]}</span>
                                        <span class="${state.ui.activeFaq === i ? 'rotate-180' : ''}">â–¼</span>
                                    </button>
                                    ${state.ui.activeFaq === i ? `<div class="p-4 pt-0 text-sm text-slate-600 bg-slate-50"><span class="font-bold text-emerald-600">A.</span> ${meetupInfo[`faq${i}A`]}</div>` : ''}
                                </div>
                            ` : '').join('')}
                        </div>
                    </div>

                    <div class="bg-indigo-50 p-6 rounded-xl border border-indigo-100 text-center">
                        <h3 class="font-bold text-indigo-900 mb-2">ê¶ê¸ˆí•œ ì ì´ ë” ìˆìœ¼ì‹ ê°€ìš”?</h3>
                        <a href="${meetupInfo.openChatLink}" target="_blank" class="inline-flex items-center gap-2 bg-yellow-400 hover:bg-yellow-500 text-black font-bold py-3 px-6 rounded-lg shadow-sm">
                            <i data-lucide="message-square" class="w-5 h-5"></i> ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…ë°©
                        </a>
                    </div>
                </main>

                <footer class="max-w-3xl mx-auto mt-12 px-4 flex justify-between items-center text-slate-400 text-sm pb-8">
                    <p>Â© 2026 ${meetupInfo.clubName}</p>
                    <button onclick="state.ui.isAdmin ? (state.ui.isAdmin=false, window.showToast('ë¡œê·¸ì•„ì›ƒ')) : state.ui.showAdminLogin=true; window.render()">
                        ${state.ui.isAdmin ? 'ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ' : 'ê´€ë¦¬ì ë¡œê·¸ì¸'}
                    </button>
                </footer>

                ${ui.showAdminLogin ? `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-[80] p-4">
                        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm">
                            <h3 class="font-bold text-lg mb-4 text-center">ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
                            <input type="password" oninput="state.ui.adminPinInput=this.value" class="w-full p-3 border rounded-lg mb-4 text-center tracking-widest" placeholder="ë¹„ë°€ë²ˆí˜¸" autofocus>
                            <div class="flex gap-2">
                                <button onclick="state.ui.showAdminLogin=false; window.render()" class="flex-1 py-2 bg-slate-100 rounded-lg">ì·¨ì†Œ</button>
                                <button onclick="handleLogin()" class="flex-1 py-2 bg-indigo-600 text-white rounded-lg">í™•ì¸</button>
                            </div>
                        </div>
                    </div>
                ` : ''}

                ${ui.showPasswordModal ? `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-[80] p-4">
                        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm">
                            <h3 class="font-bold text-lg mb-4">ì‹ ì²­ ì·¨ì†Œ í™•ì¸</h3>
                            <p class="text-sm text-slate-600 mb-4">ì‹ ì²­ ì‹œ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                            <input type="tel" maxlength="4" oninput="state.ui.cancelPasswordInput=this.value" class="w-full p-3 border rounded-lg mb-4 text-center text-xl" autofocus>
                            <div class="flex gap-2">
                                <button onclick="state.ui.showPasswordModal=false; window.render()" class="flex-1 py-2 bg-slate-100 rounded-lg">ë‹«ê¸°</button>
                                <button onclick="verifyCancelPassword()" class="flex-1 py-2 bg-red-500 text-white rounded-lg">ì·¨ì†Œí•˜ê¸°</button>
                            </div>
                        </div>
                    </div>
                ` : ''}
                
                ${ui.modalConfig ? `
                    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-[90] p-4">
                        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm">
                            <h3 class="font-bold text-lg mb-2">${ui.modalConfig.title}</h3>
                            <p class="text-slate-600 mb-6">${ui.modalConfig.message}</p>
                            <div class="flex gap-2">
                                <button onclick="state.ui.modalConfig=null; window.render()" class="flex-1 py-2 bg-slate-100 rounded-lg">ì·¨ì†Œ</button>
                                <button onclick="${ui.modalConfig.onConfirm}" class="flex-1 py-2 text-white rounded-lg ${ui.modalConfig.isDestructive?'bg-red-500':'bg-indigo-600'}">${ui.modalConfig.confirmText}</button>
                            </div>
                        </div>
                    </div>
                ` : ''}

                ${ui.isEditingInfo ? `
                    <div class="fixed inset-0 bg-black/60 z-[70] flex items-end sm:items-center justify-center p-0 sm:p-4">
                        <div class="bg-white rounded-t-xl sm:rounded-xl w-full max-w-lg flex flex-col max-h-[90vh]">
                            <div class="p-4 border-b flex justify-between items-center">
                                <h3 class="font-bold">ì„¤ì • ìˆ˜ì •</h3>
                                <button onclick="state.ui.isEditingInfo=false; window.render()"><i data-lucide="x-circle"></i></button>
                            </div>
                            <div class="overflow-y-auto p-4 space-y-4">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500">ë‚ ì§œ</label>
                                    <input type="text" value="${ui.editForm.date}" oninput="state.ui.editForm.date=this.value" class="w-full border p-2 rounded">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500">ì‹œê°„</label>
                                    <input type="text" value="${ui.editForm.time}" oninput="state.ui.editForm.time=this.value" class="w-full border p-2 rounded">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500">í† ë¡  ì§ˆë¬¸</label>
                                    <textarea oninput="state.ui.editForm.session2Question=this.value" class="w-full border p-2 rounded h-20">${ui.editForm.session2Question}</textarea>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500">ë¦¬ë” ì´ë¯¸ì§€ (íŒŒì¼)</label>
                                    <input type="file" id="leaderImageInput" accept="image/*" class="w-full text-xs">
                                </div>
                            </div>
                            <div class="p-4 border-t flex gap-2">
                                <button onclick="state.ui.isEditingInfo=false; window.render()" class="flex-1 py-3 border rounded-lg">ì·¨ì†Œ</button>
                                <button onclick="saveInfo()" class="flex-1 py-3 bg-indigo-600 text-white rounded-lg">ì €ì¥</button>
                            </div>
                        </div>
                    </div>
                ` : ''}
            `;
        }

        // --- Init ---
        let unsubscribeConfig = null;
        let unsubscribeAttendees = null;

        const initListeners = () => {
             if (unsubscribeConfig) return; 

             unsubscribeConfig = onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', CONFIG_COLLECTION, CONFIG_DOC_ID), (snap) => {
                if (snap.exists()) {
                    state.meetupInfo = { ...state.meetupInfo, ...snap.data() };
                    state.dDay = calculateDDay(state.meetupInfo.date);
                    window.render();
                }
            }, (error) => {
                console.error("Config Listener Error:", error);
            });

            unsubscribeAttendees = onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', ATTENDEES_COLLECTION), (snap) => {
                const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                state.attendees = data.sort((a,b) => (b.createdAt?.seconds||0) - (a.createdAt?.seconds||0));
                window.render();
            }, (error) => {
                console.error("Attendees Listener Error:", error);
            });
        };

        const initAuth = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        };
        
        onAuthStateChanged(auth, (u) => {
            state.user = u;
            if (u) {
                initListeners();
            }
            window.render();
        });

        initAuth();
        window.render();

    </script>
</body>
</html>
